û
4C:\Repos\Service-Billing\Components\ContactLookup.cs
	namespace 	
Service_Billing
 
. 

Components $
{ 
public 

class 
ContactLookup 
:  
ViewComponent! .
{ 
public		 
async		 
Task		 
<		  
IViewComponentResult		 .
>		. /
InvokeAsync		0 ;
(		; <
string		< B
?		B C
	elementId		D M
,		M N
List		O S
<		S T
SelectListItem		T b
>		b c
contactList		d o
)		p q
{

 	"
ContactSelectViewModel ""
contactSelectViewModel# 9
=: ;
new< ?"
ContactSelectViewModel@ V
(V W
	elementIdW `
,` a
contactListb m
)m n
;n o
return 
View 
( "
contactSelectViewModel .
). /
;/ 0
} 	
} 
} ¬
;C:\Repos\Service-Billing\Components\ServiceCategoryInput.cs
	namespace 	
Service_Billing
 
. 

Components $
{ 
public 

class  
ServiceCategoryInput %
:& '
ViewComponent( 5
{ 
public  
IViewComponentResult #
Invoke$ *
(* +
IEnumerable+ 6
<6 7
ServiceCategory7 F
>F G

categoriesH R
,R S
intT W
idX Z
)Z [
{		 	
ViewData

 
[

 
$str

 
]

 
=

 
id

 
;

  
return 
View 
( 

categories "
)" #
;# $
} 	
} 
} †ë
7C:\Repos\Service-Billing\Controllers\BillsController.cs
	namespace 	
Service_Billing
 
. 
Controllers %
{ 
public 

class 
BillsController  
:! "

Controller# -
{ 
private 
readonly 
IBillRepositroy (
_billRepository) 8
;8 9
private 
readonly &
IServiceCategoryRepository 3
_categoryRepository4 G
;G H
private 
readonly $
IClientAccountRepository 1$
_clientAccountRepository2 J
;J K
private 
readonly 
IMinistryRepository ,
_ministryRepository- @
;@ A
private 
readonly 
GraphServiceClient +
_graphServiceClient, ?
;? @
private 
readonly ?
3MicrosoftIdentityConsentAndConditionalAccessHandler L
_consentHandlerM \
;\ ]
private 
readonly 
ILogger  
<  !
BillsController! 0
>0 1
_logger2 9
;9 :
public 
BillsController 
( 
ILogger &
<& '
BillsController' 6
>6 7
logger8 >
,> ?
IBillRepositroy 
billRepository *
,* +&
IServiceCategoryRepository &
categoryRepository' 9
,9 :$
IClientAccountRepository $#
clientAccountRepository% <
,< =
IMinistryRepository 
ministryRepository  2
,2 3
IConfiguration   
configuration   (
,  ( )
GraphServiceClient!! .
graphServiceClient!!/ A
,!!A B?
3MicrosoftIdentityConsentAndConditionalAccessHandler"" O
consentHandler""P ^
)""^ _
{## 	
_graphServiceClient$$ 
=$$  !
graphServiceClient$$" 4
;$$4 5
_consentHandler%% 
=%% 
consentHandler%% ,
;%%, -
_billRepository&& 
=&& 
billRepository&& ,
;&&, -
_categoryRepository'' 
=''  !
categoryRepository''" 4
;''4 5$
_clientAccountRepository(( $
=((% &#
clientAccountRepository((' >
;((> ?
_ministryRepository)) 
=))  !
ministryRepository))" 4
;))4 5
_logger** 
=** 
logger** 
;** 
}++ 	
public-- 
IActionResult-- 
Index-- "
(--" #
string--# )
quarterFilter--* 7
,--7 8
string.. 
ministryFilter.. !
,..! "
string// 
titleFilter// 
,// 
int00 
categoryFilter00 
,00 
string11 
authorityFilter11 "
,11" #
int22 
clientNumber22 
)22 
{33 	
IEnumerable55 
<55 
ServiceCategory55 '
>55' (

categories55) 3
=554 5
_categoryRepository556 I
.55I J
GetAll55J P
(55P Q
)55Q R
;55R S
IEnumerable66 
<66 
ClientAccount66 %
>66% &
clients66' .
=66/ 0$
_clientAccountRepository661 I
.66I J
GetAll66J P
(66P Q
)66Q R
;66R S
IEnumerable77 
<77 
Ministry77  
>77  !

ministries77" ,
=77- .
_ministryRepository77/ B
.77B C
GetAll77C I
(77I J
)77J K
;77K L
if88 
(88 

ministries88 
!=88 
null88 !
&&88" $

ministries88% /
.88/ 0
Any880 3
(883 4
)884 5
)885 6
{99 
ViewData:: 
[:: 
$str:: %
]::% &
=::' (

ministries::) 3
;::3 4
};; 
if<< 
(<< 

categories<< 
!=<< 
null<< !
&&<<" $

categories<<% /
.<</ 0
Any<<0 3
(<<3 4
)<<4 5
)<<5 6
{== 
ViewBag>> 
.>> 
ServiceCategories>> )
=>>* +

categories>>, 6
.>>6 7
ToList>>7 =
(>>= >
)>>> ?
;>>? @
}?? 
ViewData@@ 
[@@ 
$str@@ $
]@@$ %
=@@& '
quarterFilter@@( 5
;@@5 6
ViewDataAA 
[AA 
$strAA %
]AA% &
=AA' (
ministryFilterAA) 7
;AA7 8
ViewDataBB 
[BB 
$strBB "
]BB" #
=BB$ %
titleFilterBB& 1
;BB1 2
ViewDataCC 
[CC 
$strCC %
]CC% &
=CC' (
categoryFilterCC) 7
;CC7 8
ViewDataDD 
[DD 
$strDD &
]DD& '
=DD( )
authorityFilterDD* 9
;DD9 :
ViewDataEE 
[EE 
$strEE #
]EE# $
=EE% &
clientNumberEE' 3
;EE3 4
IEnumerableGG 
<GG 
BillGG 
>GG 
billsGG #
=GG$ %
GetFilteredBillsGG& 6
(GG6 7
quarterFilterGG7 D
,GGD E
ministryFilterGGF T
,GGT U
titleFilterGGV a
,GGa b
categoryFilterGGc q
,GGq r
authorityFilter	GGs Ç
,
GGÇ É
clientNumber
GGÑ ê
)
GGê ë
;
GGë í
returnJJ 
ViewJJ 
(JJ 
newJJ 
AllBillsViewModelJJ -
(JJ- .
billsJJ. 3
,JJ3 4

categoriesJJ5 ?
,JJ? @
clientsJJA H
)JJH I
)JJI J
;JJJ K
}KK 	
publicMM 
ActionResultMM 
DetailsMM #
(MM# $
intMM$ '
idMM( *
)MM* +
{NN 	
BillOO 
?OO 
billOO 
=OO 
_billRepositoryOO (
.OO( )
GetBillOO) 0
(OO0 1
idOO1 3
)OO3 4
;OO4 5
ifPP 
(PP 
billPP 
==PP 
nullPP 
)PP 
{QQ 
returnRR 
NotFoundRR 
(RR  
)RR  !
;RR! "
}SS 
ClientAccountTT 
?TT 
accountTT "
=TT# $$
_clientAccountRepositoryTT% =
.TT= >
GetClientAccountTT> N
(TTN O
billTTO S
.TTS T
ClientAccountIdTTT c
)TTc d
;TTd e
ServiceCategoryUU 
?UU 
serviceCategoryUU ,
=UU- .
_categoryRepositoryUU/ B
.UUB C
GetByIdUUC J
(UUJ K
billUUK O
.UUO P
ServiceCategoryIdUUP a
)UUa b
;UUb c
ViewDataVV 
[VV 
$strVV $
]VV$ %
=VV& '
accountVV( /
!=VV0 2
nullVV3 7
?VV8 9
accountVV: A
:VVB C
$strVVD F
;VVF G
ViewDataWW 
[WW 
$strWW &
]WW& '
=WW( )
serviceCategoryWW* 9
!=WW: <
nullWW= A
?WWB C
serviceCategoryWWD S
:WWT U
$strWWV X
;WWX Y
returnXX 
ViewXX 
(XX 
billXX 
)XX 
;XX 
}YY 	
public[[ 
ActionResult[[ 
Edit[[  
([[  !
int[[! $
id[[% '
)[[' (
{\\ 	
Bill]] 
?]] 
bill]] 
=]] 
_billRepository]] (
.]]( )
GetBill]]) 0
(]]0 1
id]]1 3
)]]3 4
;]]4 5
_logger^^ 
.^^ 
LogInformation^^ "
(^^" #
$"^^# %
$str^^% ;
{^^; <
id^^< >
}^^> ?
"^^? @
)^^@ A
;^^A B
if__ 
(__ 
bill__ 
==__ 
null__ 
)__ 
_logger`` 
.`` 

LogWarning`` "
(``" #
$"``# %
$str``% 3
{``3 4
id``4 6
}``6 7
$str``7 Q
"``Q R
)``R S
;``S T
IEnumerableaa 
<aa 
ServiceCategoryaa '
>aa' (

categoriesaa) 3
=aa4 5
_categoryRepositoryaa6 I
.aaI J
GetAllaaJ P
(aaP Q
)aaQ R
;aaR S
ifbb 
(bb 
billbb 
==bb 
nullbb 
)bb 
returncc 
NotFoundcc 
(cc  
)cc  !
;cc! "
billee 
.ee 
DateModifiedee 
=ee 
DateTimeee  (
.ee( )
Nowee) ,
;ee, -
ifff 
(ff 
Stringff 
.ff 
IsNullOrEmptyff $
(ff$ %
billff% )
.ff) *
FiscalPeriodff* 6
)ff6 7
||ff8 :
Stringff; A
.ffA B
IsNullOrEmptyffB O
(ffO P
billffP T
.ffT U
BillingCycleffU a
)ffa b
)ffb c#
DetermineCurrentQuartergg '
(gg' (
billgg( ,
,gg, -
billgg. 2
.gg2 3
DateCreatedgg3 >
)gg> ?
;gg? @
ViewDatahh 
[hh 
$strhh 
]hh 
=hh  $
_clientAccountRepositoryhh! 9
.hh9 :
GetClientAccounthh: J
(hhJ K
billhhK O
.hhO P
ClientAccountIdhhP _
)hh_ `
;hh` a
ViewDataii 
[ii 
$strii !
]ii! "
=ii# $

categoriesii% /
;ii/ 0
ServiceCategoryjj 
?jj 
serviceCategoryjj ,
=jj- .
_categoryRepositoryjj/ B
.jjB C
GetByIdjjC J
(jjJ K
billjjK O
.jjO P
ServiceCategoryIdjjP a
)jja b
;jjb c
ViewDatakk 
[kk 
$strkk &
]kk& '
=kk( )
serviceCategorykk* 9
!=kk: <
nullkk= A
?kkB C
serviceCategorykkD S
:kkT U
$strkkV X
;kkX Y
returnmm 
Viewmm 
(mm 
billmm 
)mm 
;mm 
}nn 	
[qq 	
HttpPostqq	 
]qq 
[rr 	$
ValidateAntiForgeryTokenrr	 !
]rr! "
publicss 
asyncss 
Taskss 
<ss 
IActionResultss '
>ss' (
Editss) -
(ss- .
intss. 1
idss2 4
,ss4 5
IFormCollectionss6 E

collectionssF P
)ssP Q
{tt 	
Billuu 
?uu 
billToUpdateuu 
=uu  
_billRepositoryuu! 0
.uu0 1
GetBilluu1 8
(uu8 9
iduu9 ;
)uu; <
;uu< =
ifvv 
(vv 
billToUpdatevv 
==vv 
nullvv  $
)vv$ %
{ww 
returnxx 
NotFoundxx 
(xx  
)xx  !
;xx! "
}yy 
ifzz 
(zz 
awaitzz 
TryUpdateModelAsynczz )
<zz) *
Billzz* .
>zz. /
(zz/ 0
billToUpdatezz0 <
,zz< =
$strzz> @
,zz@ A
b{{ 
=>{{ 
b{{ 
.{{ 
ClientAccountId{{ &
,{{& '
b|| 
=>|| 
b|| 
.|| 

ClientName|| !
,||! "
b}} 
=>}} 
b}} 
.}} 
Title}} 
,}} 
b~~ 
=>~~ 
b~~ 
.~~ 
	IdirOrUrl~~  
,~~  !
b 
=> 
b 
. 
ServiceCategoryId (
,( )
b
ÄÄ 
=>
ÄÄ 
b
ÄÄ 
.
ÄÄ 
Amount
ÄÄ 
,
ÄÄ 
b
ÅÅ 
=>
ÅÅ 
b
ÅÅ 
.
ÅÅ 
Quantity
ÅÅ 
,
ÅÅ  
b
ÇÇ 
=>
ÇÇ 
b
ÇÇ 
.
ÇÇ &
TicketNumberAndRequester
ÇÇ /
,
ÇÇ/ 0
b
ÉÉ 
=>
ÉÉ 
b
ÉÉ 
.
ÉÉ 
DateModified
ÉÉ #
,
ÉÉ# $
b
ÑÑ 
=>
ÑÑ 
b
ÑÑ 
.
ÑÑ 
	CreatedBy
ÑÑ  
)
ÖÖ 
)
ÖÖ 
{
ÜÜ 
try
áá 
{
àà 
await
ââ 
_billRepository
ââ )
.
ââ) *

CreateBill
ââ* 4
(
ââ4 5
billToUpdate
ââ5 A
)
ââA B
;
ââB C
}
ää 
catch
ãã 
(
ãã 
DbUpdateException
ãã (
ex
ãã) +
)
ãã+ ,
{
åå 
_logger
çç 
.
çç 
LogError
çç $
(
çç$ %
$"
çç% '
$str
çç' I
{
ççI J
ex
ççJ L
.
ççL M
InnerException
ççM [
}
çç[ \
"
çç\ ]
)
çç] ^
;
çç^ _

ModelState
éé 
.
éé 
AddModelError
éé ,
(
éé, -
$str
éé- /
,
éé/ 0
$str
éé1 K
+
ééL M
$str
èè B
+
èèC D
$str
êê 8
)
êê8 9
;
êê9 :
}
ëë 
return
ìì 
RedirectToAction
ìì '
(
ìì' (
nameof
ìì( .
(
ìì. /
Index
ìì/ 4
)
ìì4 5
)
ìì5 6
;
ìì6 7
}
îî 
return
ññ 
Details
ññ 
(
ññ 
id
ññ 
)
ññ 
;
ññ 
}
óó 	
[
ôô 	
HttpGet
ôô	 
]
ôô 
public
öö 
ActionResult
öö 
Create
öö "
(
öö" #
)
öö# $
{
õõ 	
IEnumerable
úú 
<
úú 
ServiceCategory
úú '
>
úú' (

categories
úú) 3
=
úú4 5!
_categoryRepository
úú6 I
.
úúI J
GetAll
úúJ P
(
úúP Q
)
úúQ R
;
úúR S
ViewData
ùù 
[
ùù 
$str
ùù !
]
ùù! "
=
ùù# $

categories
ùù% /
;
ùù/ 0
Bill
ûû 
bill
ûû 
=
ûû 
new
ûû 
Bill
ûû  
(
ûû  !
)
ûû! "
;
ûû" #
bill
üü 
.
üü 
DateCreated
üü 
=
üü 
DateTime
üü '
.
üü' (
Now
üü( +
;
üü+ ,%
DetermineCurrentQuarter
†† #
(
††# $
bill
††$ (
,
††( )
bill
††* .
.
††. /
DateCreated
††/ :
)
††: ;
;
††; <
return
¢¢ 
View
¢¢ 
(
¢¢ 
bill
¢¢ 
)
¢¢ 
;
¢¢ 
}
££ 	
[
•• 	
HttpPost
••	 
]
•• 
[
¶¶ 	&
ValidateAntiForgeryToken
¶¶	 !
]
¶¶! "
public
®® 
async
®® 
Task
®® 
<
®® 
ActionResult
®® &
>
®®& '
Create
®®( .
(
®®. /
Bill
®®/ 3
bill
®®4 8
)
®®8 9
{
©© 	
try
™™ 
{
´´ 
if
¨¨ 
(
¨¨ 

ModelState
¨¨ 
.
¨¨ 
IsValid
¨¨ &
)
¨¨& '
{
≠≠ 
_logger
ÆÆ 
.
ÆÆ 
LogInformation
ÆÆ *
(
ÆÆ* +
$"
ÆÆ+ -
$str
ÆÆ- @
"
ÆÆ@ A
)
ÆÆA B
;
ÆÆB C
await
ØØ 
_billRepository
ØØ )
.
ØØ) *

CreateBill
ØØ* 4
(
ØØ4 5
bill
ØØ5 9
)
ØØ9 :
;
ØØ: ;
}
∞∞ 
else
±± 
{
≤≤ 
_logger
≥≥ 
.
≥≥ 

LogWarning
≥≥ &
(
≥≥& '
$"
≥≥' )
$str
≥≥) Q
"
≥≥Q R
)
≥≥R S
;
≥≥S T
}
¥¥ 
}
µµ 
catch
∂∂ 
(
∂∂ 
DbUpdateException
∂∂ $
ex
∂∂% '
)
∂∂' (
{
∑∑ 
_logger
∏∏ 
.
∏∏ 
LogError
∏∏  
(
∏∏  !
$"
∏∏! #
$str
∏∏# a
{
∏∏a b
ex
∏∏b d
.
∏∏d e
InnerException
∏∏e s
}
∏∏s t
"
∏∏t u
)
∏∏u v
;
∏∏v w

ModelState
ππ 
.
ππ 
AddModelError
ππ (
(
ππ( )
$str
ππ) +
,
ππ+ ,
$strππ- å
)ππå ç
;ππç é
}
∫∫ 
return
ºº 
RedirectToAction
ºº #
(
ºº# $
nameof
ºº$ *
(
ºº* +
Index
ºº+ 0
)
ºº0 1
)
ºº1 2
;
ºº2 3
}
ΩΩ 	
[
øø 	
HttpGet
øø	 
]
øø 
public
¿¿ 
ActionResult
¿¿ 
GetBillAmount
¿¿ )
(
¿¿) *
short
¿¿* /
?
¿¿/ 0
	serviceId
¿¿1 :
,
¿¿: ;
decimal
¿¿< C
?
¿¿C D
quantity
¿¿E M
)
¿¿M N
{
¡¡ 	
try
¬¬ 
{
√√ 
if
ƒƒ 
(
ƒƒ 
	serviceId
ƒƒ 
==
ƒƒ  
null
ƒƒ! %
||
ƒƒ& (
quantity
ƒƒ) 1
==
ƒƒ2 4
null
ƒƒ5 9
)
ƒƒ9 :
throw
≈≈ 
new
≈≈ 
	Exception
≈≈ '
(
≈≈' (
$str
≈≈( m
)
≈≈m n
;
≈≈n o
ServiceCategory
∆∆ 
category
∆∆  (
=
∆∆) *!
_categoryRepository
∆∆+ >
.
∆∆> ?
GetById
∆∆? F
(
∆∆F G
	serviceId
∆∆G P
)
∆∆P Q
;
∆∆Q R
if
«« 
(
«« 
category
«« 
==
«« 
null
««  $
)
««$ %
{
»» 
throw
…… 
new
…… 
	Exception
…… '
(
……' (
$"
……( *
$str
……* D
{
……D E
	serviceId
……E N
}
……N O
$str
……O Z
"
……Z [
)
……[ \
;
……\ ]
}
   
decimal
ÀÀ 
	newAmount
ÀÀ !
;
ÀÀ! "
if
ÃÃ 
(
ÃÃ 
!
ÃÃ 
decimal
ÃÃ 
.
ÃÃ 
TryParse
ÃÃ %
(
ÃÃ% &
category
ÃÃ& .
.
ÃÃ. /
Costs
ÃÃ/ 4
,
ÃÃ4 5
out
ÃÃ6 9
	newAmount
ÃÃ: C
)
ÃÃC D
)
ÃÃD E
{
ÕÕ 
	newAmount
ŒŒ 
=
ŒŒ 
$num
ŒŒ  !
;
ŒŒ! "
}
œœ 
if
–– 
(
–– 
category
–– 
.
–– 
	ServiceId
–– &
==
––' )
$num
––* +
)
––+ ,
	newAmount
—— 
=
—— 
$num
——  "
;
——" #
string
““ 
?
““ 
UOM
““ 
=
““ 
!
““ 
string
““ %
.
““% &
IsNullOrEmpty
““& 3
(
““3 4
category
““4 <
.
““< =
UOM
““= @
)
““@ A
?
““B C
category
““D L
.
““L M
UOM
““M P
:
““Q R
$str
““S X
;
““X Y
RecordEntry
”” 
recordEntry
”” '
=
””( )
new
””* -
RecordEntry
””. 9
(
””9 :
category
””: B
.
””B C
Name
””C G
,
””G H
	newAmount
””I R
*
””S T
quantity
””U ]
)
””] ^
;
””^ _
recordEntry
‘‘ 
.
‘‘ 
UOM
‘‘ 
=
‘‘  !
UOM
‘‘" %
;
‘‘% &
return
÷÷ 
new
÷÷ 

JsonResult
÷÷ %
(
÷÷% &
recordEntry
÷÷& 1
)
÷÷1 2
;
÷÷2 3
}
◊◊ 
catch
ÿÿ 
(
ÿÿ 
	Exception
ÿÿ 
ex
ÿÿ 
)
ÿÿ  
{
ŸŸ 
return
€€ 
new
€€ 

JsonResult
€€ %
(
€€% &
ex
€€& (
.
€€( )
Message
€€) 0
)
€€0 1
;
€€1 2
}
‹‹ 
}
›› 	
[
ﬂﬂ 	
HttpGet
ﬂﬂ	 
]
ﬂﬂ 
public
‡‡ 
ActionResult
‡‡ 

GetClients
‡‡ &
(
‡‡& '
)
‡‡' (
{
·· 	
try
‚‚ 
{
„„ 
IEnumerable
‰‰ 
<
‰‰ 
ClientAccount
‰‰ )
>
‰‰) *
accounts
‰‰+ 3
=
‰‰4 5&
_clientAccountRepository
‰‰6 N
.
‰‰N O
GetAll
‰‰O U
(
‰‰U V
)
‰‰V W
;
‰‰W X
List
ÂÂ 
<
ÂÂ 
ClientAccount
ÂÂ "
>
ÂÂ" #
result
ÂÂ$ *
=
ÂÂ+ ,
accounts
ÂÂ- 5
.
ÂÂ5 6
ToList
ÂÂ6 <
(
ÂÂ< =
)
ÂÂ= >
;
ÂÂ> ?
return
ÊÊ 
new
ÊÊ 

JsonResult
ÊÊ %
(
ÊÊ% &
accounts
ÊÊ& .
.
ÊÊ. /
ToList
ÊÊ/ 5
(
ÊÊ5 6
)
ÊÊ6 7
)
ÊÊ7 8
;
ÊÊ8 9
}
ÁÁ 
catch
ËË 
(
ËË 
	Exception
ËË 
ex
ËË 
)
ËË  
{
ÈÈ 
return
ÍÍ 
new
ÍÍ 

JsonResult
ÍÍ %
(
ÍÍ% &
ex
ÍÍ& (
.
ÍÍ( )
Message
ÍÍ) 0
)
ÍÍ0 1
;
ÍÍ1 2
}
ÎÎ 
}
ÏÏ 	
public
ÓÓ 
void
ÓÓ %
DetermineCurrentQuarter
ÓÓ +
(
ÓÓ+ ,
Bill
ÓÓ, 0
bill
ÓÓ1 5
,
ÓÓ5 6
DateTime
ÓÓ7 ?
?
ÓÓ? @
date
ÓÓA E
=
ÓÓF G
null
ÓÓH L
)
ÓÓL M
{
ÔÔ 	
DateTime
 
today
 
=
 
DateTime
 %
.
% &
Today
& +
;
+ ,
if
ÒÒ 
(
ÒÒ 
date
ÒÒ 
!=
ÒÒ 
null
ÒÒ 
)
ÒÒ 
today
ÚÚ 
=
ÚÚ 
date
ÚÚ 
.
ÚÚ 
Value
ÚÚ "
;
ÚÚ" #
string
ÛÛ 
quarter
ÛÛ 
=
ÛÛ 
$str
ÛÛ 
;
ÛÛ  
string
ÙÙ 
year1
ÙÙ 
=
ÙÙ 
today
ÙÙ  
.
ÙÙ  !
Year
ÙÙ! %
.
ÙÙ% &
ToString
ÙÙ& .
(
ÙÙ. /
)
ÙÙ/ 0
;
ÙÙ0 1
string
ıı 
year2
ıı 
=
ıı 
(
ıı 
today
ıı !
.
ıı! "
Year
ıı" &
+
ıı' (
$num
ıı) *
)
ıı* +
.
ıı+ ,
ToString
ıı, 4
(
ıı4 5
)
ıı5 6
;
ıı6 7
switch
˜˜ 
(
˜˜ 
today
˜˜ 
.
˜˜ 
Month
˜˜ 
)
˜˜  
{
¯¯ 
case
˘˘ 
$num
˘˘ 
:
˘˘ 
case
˙˙ 
$num
˙˙ 
:
˙˙ 
case
˚˚ 
$num
˚˚ 
:
˚˚ 
quarter
¸¸ 
=
¸¸ 
$str
¸¸ )
;
¸¸) *
bill
˝˝ 
.
˝˝ 
BillingCycle
˝˝ %
=
˝˝& '
new
˝˝( +
DateTime
˝˝, 4
(
˝˝4 5
today
˝˝5 :
.
˝˝: ;
Year
˝˝; ?
,
˝˝? @
$num
˝˝A B
,
˝˝B C
$num
˝˝D E
)
˝˝E F
.
˝˝F G
ToString
˝˝G O
(
˝˝O P
$str
˝˝P \
)
˝˝\ ]
;
˝˝] ^
break
˛˛ 
;
˛˛ 
case
ˇˇ 
$num
ˇˇ 
:
ˇˇ 
case
ÄÄ 
$num
ÄÄ 
:
ÄÄ 
case
ÅÅ 
$num
ÅÅ 
:
ÅÅ 
quarter
ÇÇ 
=
ÇÇ 
$str
ÇÇ )
;
ÇÇ) *
bill
ÉÉ 
.
ÉÉ 
BillingCycle
ÉÉ %
=
ÉÉ& '
new
ÉÉ( +
DateTime
ÉÉ, 4
(
ÉÉ4 5
today
ÉÉ5 :
.
ÉÉ: ;
Year
ÉÉ; ?
,
ÉÉ? @
$num
ÉÉA B
,
ÉÉB C
$num
ÉÉD E
)
ÉÉE F
.
ÉÉF G
ToString
ÉÉG O
(
ÉÉO P
$str
ÉÉP \
)
ÉÉ\ ]
;
ÉÉ] ^
break
ÑÑ 
;
ÑÑ 
case
ÖÖ 
$num
ÖÖ 
:
ÖÖ 
case
ÜÜ 
$num
ÜÜ 
:
ÜÜ 
case
áá 
$num
áá 
:
áá 
quarter
àà 
=
àà 
$str
àà )
;
àà) *
bill
ââ 
.
ââ 
BillingCycle
ââ %
=
ââ& '
new
ââ( +
DateTime
ââ, 4
(
ââ4 5
today
ââ5 :
.
ââ: ;
Year
ââ; ?
,
ââ? @
$num
ââA C
,
ââC D
$num
ââE F
)
ââF G
.
ââG H
ToString
ââH P
(
ââP Q
$str
ââQ ]
)
ââ] ^
;
ââ^ _
break
ää 
;
ää 
case
ãã 
$num
ãã 
:
ãã 
case
åå 
$num
åå 
:
åå 
case
çç 
$num
çç 
:
çç 
quarter
éé 
=
éé 
$str
éé )
;
éé) *
bill
èè 
.
èè 
BillingCycle
èè %
=
èè& '
new
èè( +
DateTime
èè, 4
(
èè4 5
today
èè5 :
.
èè: ;
Year
èè; ?
,
èè? @
$num
èèA B
,
èèB C
$num
èèD E
)
èèE F
.
èèF G
ToString
èèG O
(
èèO P
$str
èèP \
)
èè\ ]
;
èè] ^
break
êê 
;
êê 
}
ëë 
bill
ìì 
.
ìì 
FiscalPeriod
ìì 
=
ìì 
$"
ìì  "
$str
ìì" )
{
ìì) *
year1
ìì* /
.
ìì/ 0
	Substring
ìì0 9
(
ìì9 :
$num
ìì: ;
)
ìì; <
}
ìì< =
$str
ìì= >
{
ìì> ?
year2
ìì? D
.
ììD E
	Substring
ììE N
(
ììN O
$num
ììO P
)
ììP Q
}
ììQ R
$str
ììR S
{
ììS T
quarter
ììT [
}
ìì[ \
"
ìì\ ]
;
ìì] ^
}
îî 	
[
ññ 	 
AuthorizeForScopes
ññ	 
(
ññ 
ScopeKeySection
ññ +
=
ññ, -
$str
ññ. D
)
ññD E
]
ññE F
public
óó 
async
óó 
Task
óó 
<
óó 
String
óó  
>
óó  !
	GetMyName
óó" +
(
óó+ ,
)
óó, -
{
òò 	
try
ôô 
{
öö 
var
õõ 
myName
õõ 
=
õõ 
await
õõ "!
_graphServiceClient
õõ# 6
.
õõ6 7
Me
õõ7 9
.
õõ9 :
Request
õõ: A
(
õõA B
)
õõB C
.
úú 
Select
úú 
(
úú 
$str
úú )
)
úú) *
.
ùù 
GetAsync
ùù 
(
ùù 
)
ùù 
;
ùù  
return
üü 
myName
üü 
.
üü 
DisplayName
üü )
;
üü) *
}
†† 
catch
°° 
(
°° 
	Exception
°° 
ex
°° 
)
°°  
{
¢¢ 
return
££ 
$str
££ 8
;
££8 9
}
§§ 
}
•• 	
private
ßß 
IEnumerable
ßß 
<
ßß 
Bill
ßß  
>
ßß  !
GetFilteredBills
ßß" 2
(
ßß2 3
string
ßß3 9
quarterFilter
ßß: G
,
ßßG H
string
®® 
ministryFilter
®® !
,
®®! "
string
©© 
titleFilter
©© 
,
©© 
int
™™ 
categoryFilter
™™ 
,
™™ 
string
´´ 
authorityFilter
´´ "
,
´´" #
int
¨¨ 
clientNumber
¨¨ 
)
¨¨ 
{
≠≠ 	
IEnumerable
ÆÆ 
<
ÆÆ 
Bill
ÆÆ 
>
ÆÆ 
bills
ÆÆ #
;
ÆÆ# $
switch
ØØ 
(
ØØ 
quarterFilter
ØØ !
)
ØØ! "
{
∞∞ 
case
±± 
$str
±± 
:
±± 
default
≤≤ 
:
≤≤ 
ViewData
≥≥ 
[
≥≥ 
$str
≥≥ &
]
≥≥& '
=
≥≥( )
$str
≥≥* ;
;
≥≥; <
bills
¥¥ 
=
¥¥ 
_billRepository
¥¥ +
.
¥¥+ ,$
GetCurrentQuarterBills
¥¥, B
(
¥¥B C
)
¥¥C D
;
¥¥D E
break
µµ 
;
µµ 
case
∂∂ 
$str
∂∂ 
:
∂∂  
ViewData
∑∑ 
[
∑∑ 
$str
∑∑ &
]
∑∑& '
=
∑∑( )
$str
∑∑* <
;
∑∑< =
bills
∏∏ 
=
∏∏ 
_billRepository
∏∏ +
.
∏∏+ ,%
GetPreviousQuarterBills
∏∏, C
(
∏∏C D
)
∏∏D E
;
∏∏E F
break
ππ 
;
ππ 
case
∫∫ 
$str
∫∫ 
:
∫∫ 
ViewData
ªª 
[
ªª 
$str
ªª &
]
ªª& '
=
ªª( )
$str
ªª* 8
;
ªª8 9
bills
ºº 
=
ºº 
_billRepository
ºº +
.
ºº+ ,
AllBills
ºº, 4
;
ºº4 5
break
ΩΩ 
;
ΩΩ 
}
ææ 
if
¿¿ 
(
¿¿ 
!
¿¿ 
string
¿¿ 
.
¿¿ 
IsNullOrEmpty
¿¿ %
(
¿¿% &
ministryFilter
¿¿& 4
)
¿¿4 5
)
¿¿5 6
bills
¡¡ 
=
¡¡ 
bills
¡¡ 
.
¡¡ 
Where
¡¡ #
(
¡¡# $
x
¡¡$ %
=>
¡¡& (
x
¡¡) *
.
¡¡* +

ClientName
¡¡+ 5
.
¡¡5 6
ToLower
¡¡6 =
(
¡¡= >
)
¡¡> ?
.
¡¡? @
Contains
¡¡@ H
(
¡¡H I
ministryFilter
¡¡I W
.
¡¡W X
ToLower
¡¡X _
(
¡¡_ `
)
¡¡` a
)
¡¡a b
)
¡¡b c
;
¡¡c d
if
¬¬ 
(
¬¬ 
!
¬¬ 
string
¬¬ 
.
¬¬ 
IsNullOrEmpty
¬¬ %
(
¬¬% &
titleFilter
¬¬& 1
)
¬¬1 2
)
¬¬2 3
bills
√√ 
=
√√ 
bills
√√ 
.
√√ 
Where
√√ #
(
√√# $
x
√√$ %
=>
√√& (
x
√√) *
.
√√* +
Title
√√+ 0
.
√√0 1
ToLower
√√1 8
(
√√8 9
)
√√9 :
.
√√: ;
Contains
√√; C
(
√√C D
titleFilter
√√D O
.
√√O P
ToLower
√√P W
(
√√W X
)
√√X Y
)
√√Y Z
)
√√Z [
;
√√[ \
if
ƒƒ 
(
ƒƒ 
categoryFilter
ƒƒ 
>
ƒƒ  
$num
ƒƒ! "
)
ƒƒ" #
bills
≈≈ 
=
≈≈ 
bills
≈≈ 
.
≈≈ 
Where
≈≈ #
(
≈≈# $
x
≈≈$ %
=>
≈≈& (
x
≈≈) *
.
≈≈* +
ServiceCategoryId
≈≈+ <
==
≈≈= ?
categoryFilter
≈≈@ N
)
≈≈N O
;
≈≈O P
if
∆∆ 
(
∆∆ 
!
∆∆ 
string
∆∆ 
.
∆∆ 
IsNullOrEmpty
∆∆ %
(
∆∆% &
authorityFilter
∆∆& 5
)
∆∆5 6
)
∆∆6 7
{
«« 
List
»» 
<
»» 
Bill
»» 
>
»» 
filteredBills
»» (
=
»») *
new
»»+ .
List
»»/ 3
<
»»3 4
Bill
»»4 8
>
»»8 9
(
»»9 :
)
»»: ;
;
»»; <
foreach
…… 
(
…… 
Bill
…… 
bill
…… "
in
……# %
bills
……& +
)
……+ ,
{
   
ClientAccount
ÀÀ !
?
ÀÀ! "
account
ÀÀ# *
=
ÀÀ+ ,&
_clientAccountRepository
ÀÀ- E
.
ÀÀE F
GetClientAccount
ÀÀF V
(
ÀÀV W
bill
ÀÀW [
.
ÀÀ[ \
ClientAccountId
ÀÀ\ k
)
ÀÀk l
;
ÀÀl m
if
ÃÃ 
(
ÃÃ 
account
ÃÃ 
!=
ÃÃ  "
null
ÃÃ# '
&&
ÃÃ( *
!
ÃÃ+ ,
String
ÃÃ, 2
.
ÃÃ2 3
IsNullOrEmpty
ÃÃ3 @
(
ÃÃ@ A
account
ÃÃA H
.
ÃÃH I"
ExpenseAuthorityName
ÃÃI ]
)
ÃÃ] ^
&&
ÃÃ_ a
account
ÃÃb i
.
ÃÃi j"
ExpenseAuthorityName
ÃÃj ~
.
ÃÃ~ 
ContainsÃÃ á
(ÃÃá à
authorityFilterÃÃà ó
)ÃÃó ò
)ÃÃò ô
{
ÕÕ 
filteredBills
ŒŒ %
.
ŒŒ% &
Append
ŒŒ& ,
(
ŒŒ, -
bill
ŒŒ- 1
)
ŒŒ1 2
;
ŒŒ2 3
}
œœ 
}
–– 
bills
““ 
=
““ 
filteredBills
““ %
;
““% &
}
”” 
if
‘‘ 
(
‘‘ 
clientNumber
‘‘ 
>
‘‘ 
$num
‘‘  
)
‘‘  !
{
’’ 
int
÷÷ 
clientId
÷÷ 
=
÷÷ &
_clientAccountRepository
÷÷ 7
.
÷÷7 8)
GetClientIdFromClientNumber
÷÷8 S
(
÷÷S T
clientNumber
÷÷T `
)
÷÷` a
;
÷÷a b
bills
◊◊ 
=
◊◊ 
bills
◊◊ 
.
◊◊ 
Where
◊◊ #
(
◊◊# $
x
◊◊$ %
=>
◊◊& (
x
◊◊) *
.
◊◊* +
ClientAccountId
◊◊+ :
==
◊◊; =
clientId
◊◊> F
)
◊◊F G
;
◊◊G H
}
ÿÿ 
return
⁄⁄ 
bills
⁄⁄ 
;
⁄⁄ 
}
€€ 	
[
›› 	
HttpGet
››	 
]
›› 
public
ﬁﬁ 
async
ﬁﬁ 
Task
ﬁﬁ 
<
ﬁﬁ 
IActionResult
ﬁﬁ '
>
ﬁﬁ' (

WriteToCSV
ﬁﬁ) 3
(
ﬁﬁ3 4
string
ﬁﬁ4 :
quarterFilter
ﬁﬁ; H
,
ﬁﬁH I
string
ﬂﬂ 
ministryFilter
ﬂﬂ !
,
ﬂﬂ! "
string
‡‡ 
titleFilter
‡‡ 
,
‡‡ 
int
·· 
categoryFilter
·· 
,
·· 
string
‚‚ 
authorityFilter
‚‚ "
,
‚‚" #
int
„„ 
clientNumber
„„ 
)
„„ 
{
‰‰ 	
IEnumerable
ÂÂ 
<
ÂÂ 
Bill
ÂÂ 
>
ÂÂ 
bills
ÂÂ #
=
ÂÂ$ %
GetFilteredBills
ÂÂ& 6
(
ÂÂ6 7
quarterFilter
ÂÂ7 D
,
ÂÂD E
ministryFilter
ÂÂF T
,
ÂÂT U
titleFilter
ÂÂV a
,
ÂÂa b
categoryFilter
ÂÂc q
,
ÂÂq r
authorityFilterÂÂs Ç
,ÂÂÇ É
clientNumberÂÂÑ ê
)ÂÂê ë
;ÂÂë í
try
ÊÊ 
{
ÁÁ 
using
ËË 
var
ËË 
memoryStream
ËË &
=
ËË' (
new
ËË) ,
MemoryStream
ËË- 9
(
ËË9 :
)
ËË: ;
;
ËË; <
using
ÈÈ 
(
ÈÈ 
var
ÈÈ 
streamWriter
ÈÈ '
=
ÈÈ( )
new
ÈÈ* -
StreamWriter
ÈÈ. :
(
ÈÈ: ;
memoryStream
ÈÈ; G
)
ÈÈG H
)
ÈÈH I
{
ÍÍ 
using
ÎÎ 
var
ÎÎ 
	csvWriter
ÎÎ '
=
ÎÎ( )
new
ÎÎ* -
	CsvWriter
ÎÎ. 7
(
ÎÎ7 8
streamWriter
ÎÎ8 D
)
ÎÎD E
;
ÎÎE F
	csvWriter
ÏÏ 
.
ÏÏ 
WriteRecords
ÏÏ *
(
ÏÏ* +
bills
ÏÏ+ 0
)
ÏÏ0 1
;
ÏÏ1 2
}
ÌÌ 
string
ÓÓ 
fileName
ÓÓ 
=
ÓÓ  !
$str
ÓÓ" +
;
ÓÓ+ ,
if
ÔÔ 
(
ÔÔ 
!
ÔÔ 
string
ÔÔ 
.
ÔÔ 
IsNullOrEmpty
ÔÔ )
(
ÔÔ) *
quarterFilter
ÔÔ* 7
)
ÔÔ7 8
)
ÔÔ8 9
{
 
if
ÒÒ 
(
ÒÒ 
quarterFilter
ÒÒ %
==
ÒÒ& (
$str
ÒÒ) .
)
ÒÒ. /
fileName
ÚÚ  
+=
ÚÚ! #
$str
ÚÚ$ 3
;
ÚÚ3 4
if
ÛÛ 
(
ÛÛ 
bills
ÛÛ 
.
ÛÛ 
Any
ÛÛ !
(
ÛÛ! "
)
ÛÛ" #
)
ÛÛ# $
{
ÙÙ 
fileName
ıı  
+=
ıı! #
$"
ıı$ &
$str
ıı& '
{
ıı' (
bills
ıı( -
.
ıı- .
First
ıı. 3
(
ıı3 4
)
ıı4 5
.
ıı5 6
BillingCycle
ıı6 B
}
ııB C
"
ııC D
;
ııD E
}
ˆˆ 
}
˜˜ 
if
¯¯ 
(
¯¯ 
!
¯¯ 
String
¯¯ 
.
¯¯ 
IsNullOrEmpty
¯¯ )
(
¯¯) *
ministryFilter
¯¯* 8
)
¯¯8 9
)
¯¯9 :
fileName
˘˘ 
+=
˘˘ 
$"
˘˘  "
$str
˘˘" #
{
˘˘# $
ministryFilter
˘˘$ 2
}
˘˘2 3
"
˘˘3 4
;
˘˘4 5
if
˙˙ 
(
˙˙ 
!
˙˙ 
String
˙˙ 
.
˙˙ 
IsNullOrEmpty
˙˙ )
(
˙˙) *
titleFilter
˙˙* 5
)
˙˙5 6
)
˙˙6 7
fileName
˚˚ 
+=
˚˚ 
$"
˚˚  "
$str
˚˚" #
{
˚˚# $
titleFilter
˚˚$ /
}
˚˚/ 0
"
˚˚0 1
;
˚˚1 2
if
¸¸ 
(
¸¸ 
categoryFilter
¸¸ "
>
¸¸# $
$num
¸¸% &
)
¸¸& '
{
˝˝ 
ServiceCategory
˛˛ #
category
˛˛$ ,
=
˛˛- .!
_categoryRepository
˛˛/ B
.
˛˛B C
GetById
˛˛C J
(
˛˛J K
categoryFilter
˛˛K Y
)
˛˛Y Z
;
˛˛Z [
if
ˇˇ 
(
ˇˇ 
category
ˇˇ  
!=
ˇˇ! #
null
ˇˇ$ (
)
ˇˇ( )
fileName
ÄÄ  
+=
ÄÄ! #
$"
ÄÄ$ &
$str
ÄÄ& '
{
ÄÄ' (
category
ÄÄ( 0
.
ÄÄ0 1
Name
ÄÄ1 5
}
ÄÄ5 6
"
ÄÄ6 7
;
ÄÄ7 8
}
ÅÅ 
if
ÇÇ 
(
ÇÇ 
!
ÇÇ 
String
ÇÇ 
.
ÇÇ 
IsNullOrEmpty
ÇÇ )
(
ÇÇ) *
authorityFilter
ÇÇ* 9
)
ÇÇ9 :
)
ÇÇ: ;
fileName
ÉÉ 
+=
ÉÉ 
$"
ÉÉ  "
$str
ÉÉ" #
{
ÉÉ# $
authorityFilter
ÉÉ$ 3
}
ÉÉ3 4
"
ÉÉ4 5
;
ÉÉ5 6
fileName
ÖÖ 
+=
ÖÖ 
DateTime
ÖÖ $
.
ÖÖ$ %
Today
ÖÖ% *
.
ÖÖ* +
ToString
ÖÖ+ 3
(
ÖÖ3 4
$str
ÖÖ4 @
)
ÖÖ@ A
;
ÖÖA B
fileName
ÜÜ 
+=
ÜÜ 
$str
ÜÜ "
;
ÜÜ" #
return
àà 
File
àà 
(
àà 
memoryStream
àà (
.
àà( )
ToArray
àà) 0
(
àà0 1
)
àà1 2
,
àà2 3
$str
àà4 N
,
ààN O
fileName
ààP X
)
ààX Y
;
ààY Z
}
ââ 
catch
ää 
(
ää 
	Exception
ää 
ex
ää 
)
ää  
{
ãã 
return
çç 

StatusCode
çç !
(
çç! "
$num
çç" %
)
çç% &
;
çç& '
}
éé 
}
èè 	
public
ëë 
async
ëë 
Task
ëë 
<
ëë 
IActionResult
ëë '
>
ëë' (

ShowReport
ëë) 3
(
ëë3 4
string
ëë4 :
quarterFilter
ëë; H
,
ëëH I
string
íí 
ministryFilter
íí !
,
íí! "
string
ìì 
titleFilter
ìì 
,
ìì 
int
îî 
categoryFilter
îî 
,
îî 
string
ïï 
authorityFilter
ïï "
,
ïï" #
int
ññ 
clientNumber
ññ 
)
ññ 
{
óó 	
IEnumerable
òò 
<
òò 
Bill
òò 
>
òò 
bills
òò #
=
òò$ %
GetFilteredBills
òò& 6
(
òò6 7
quarterFilter
òò7 D
,
òòD E
ministryFilter
òòF T
,
òòT U
titleFilter
òòV a
,
òòa b
categoryFilter
òòc q
,
òòq r
authorityFilteròòs Ç
,òòÇ É
clientNumberòòÑ ê
)òòê ë
;òòë í
try
ôô 
{
öö &
GeneratedReportViewModel
õõ (
model
õõ) .
=
õõ/ 0
new
õõ1 4&
GeneratedReportViewModel
õõ5 M
(
õõM N
)
õõN O
;
õõO P
model
úú 
.
úú 
BillingQuarter
úú $
=
úú% &
quarterFilter
úú' 4
;
úú4 5
model
ùù 
.
ùù 
Ministry
ùù 
=
ùù  
ministryFilter
ùù! /
;
ùù/ 0
model
ûû 
.
ûû 
Title
ûû 
=
ûû 
titleFilter
ûû )
;
ûû) *
model
üü 
.
üü 
	Authority
üü 
=
üü  !
authorityFilter
üü" 1
;
üü1 2
model
†† 
.
†† 
ClientNumber
†† "
=
††# $
clientNumber
††% 1
;
††1 2
if
°° 
(
°° 
categoryFilter
°° "
>
°°# $
$num
°°% &
)
°°& '
{
¢¢ 
ServiceCategory
££ #
?
££# $
serviceCategory
££% 4
=
££5 6!
_categoryRepository
££7 J
.
££J K
GetById
££K R
(
££R S
categoryFilter
££S a
)
££a b
;
££b c
if
§§ 
(
§§ 
serviceCategory
§§ '
!=
§§( *
null
§§+ /
&&
§§0 2
!
§§3 4
String
§§4 :
.
§§: ;
IsNullOrEmpty
§§; H
(
§§H I
serviceCategory
§§I X
.
§§X Y
Name
§§Y ]
)
§§] ^
)
§§^ _
model
•• 
.
•• 
Service
•• %
=
••& '
serviceCategory
••( 7
.
••7 8
Name
••8 <
;
••< =
}
¶¶ 
model
ßß 
.
ßß 
ServiceCategoryId
ßß '
=
ßß( )
categoryFilter
ßß* 8
;
ßß8 9
SortedDictionary
®®  
<
®®  !
string
®®! '
,
®®' (
decimal
®®) 0
?
®®0 1
>
®®1 2
servicesAndSums
®®3 B
=
®®C D 
GetServicesAndSums
®®E W
(
®®W X
bills
®®X ]
)
®®] ^
;
®®^ _
model
´´ 
.
´´ 
ServicesAndSums
´´ %
=
´´& '
servicesAndSums
´´( 7
;
´´7 8
return
≠≠ 
View
≠≠ 
(
≠≠ 
$str
≠≠ $
,
≠≠$ %
model
≠≠& +
)
≠≠+ ,
;
≠≠, -
}
ÆÆ 
catch
ØØ 
(
ØØ 
	Exception
ØØ 
ex
ØØ 
)
ØØ  
{
∞∞ 
}
≤≤ 
return
¥¥ 
Ok
¥¥ 
(
¥¥ 
$num
¥¥ 
)
¥¥ 
;
¥¥ 
}
µµ 	
[
∑∑ 	
HttpGet
∑∑	 
]
∑∑ 
public
∏∏ 
async
∏∏ 
Task
∏∏ 
<
∏∏ 
IActionResult
∏∏ '
>
∏∏' (
ReportToCSV
∏∏) 4
(
∏∏4 5
string
∏∏5 ;
quarterFilter
∏∏< I
,
∏∏I J
string
ππ 
ministryFilter
ππ !
,
ππ! "
string
∫∫ 
titleFilter
∫∫ 
,
∫∫ 
int
ªª 
categoryFilter
ªª 
,
ªª 
string
ºº 
authorityFilter
ºº "
,
ºº" #
int
ΩΩ 
clientNumber
ΩΩ 
)
ΩΩ 
{
ææ 	
IEnumerable
øø 
<
øø 
Bill
øø 
>
øø 
bills
øø #
=
øø$ %
GetFilteredBills
øø& 6
(
øø6 7
quarterFilter
øø7 D
,
øøD E
ministryFilter
øøF T
,
øøT U
titleFilter
øøV a
,
øøa b
categoryFilter
øøc q
,
øøq r
authorityFilterøøs Ç
,øøÇ É
clientNumberøøÑ ê
)øøê ë
;øøë í
SortedDictionary
¿¿ 
<
¿¿ 
string
¿¿ #
,
¿¿# $
decimal
¿¿% ,
?
¿¿, -
>
¿¿- .
servicesAndSums
¿¿/ >
=
¿¿? @ 
GetServicesAndSums
¿¿A S
(
¿¿S T
bills
¿¿T Y
)
¿¿Y Z
;
¿¿Z [
List
¡¡ 
<
¡¡ 
RecordEntry
¡¡ 
>
¡¡ 
records
¡¡ %
=
¡¡& '
new
¡¡( +
List
¡¡, 0
<
¡¡0 1
RecordEntry
¡¡1 <
>
¡¡< =
(
¡¡= >
)
¡¡> ?
;
¡¡? @
decimal
¬¬ 
?
¬¬ 
total
¬¬ 
=
¬¬ 
$num
¬¬ 
;
¬¬ 
foreach
ƒƒ 
(
ƒƒ 
var
ƒƒ 
entry
ƒƒ 
in
ƒƒ !
servicesAndSums
ƒƒ" 1
)
ƒƒ1 2
{
≈≈ 
records
∆∆ 
.
∆∆ 
Add
∆∆ 
(
∆∆ 
new
∆∆ 
RecordEntry
∆∆  +
(
∆∆+ ,
entry
∆∆, 1
.
∆∆1 2
Key
∆∆2 5
,
∆∆5 6
entry
∆∆7 <
.
∆∆< =
Value
∆∆= B
)
∆∆B C
)
∆∆C D
;
∆∆D E
total
«« 
+=
«« 
entry
«« 
.
«« 
Value
«« $
;
««$ %
}
»» 
var
   
summedTotal
   
=
   
new
   !
List
  " &
<
  & '
object
  ' -
>
  - .
{
ÀÀ 
new
ÃÃ 
{
ÃÃ 
Id
ÃÃ 
=
ÃÃ 
$str
ÃÃ (
,
ÃÃ( )
Name
ÃÃ* .
=
ÃÃ/ 0
total
ÃÃ1 6
}
ÃÃ7 8
,
ÃÃ8 9
}
ÕÕ 
;
ÕÕ 
using
ŒŒ 
var
ŒŒ 
memoryStream
ŒŒ "
=
ŒŒ# $
new
ŒŒ% (
MemoryStream
ŒŒ) 5
(
ŒŒ5 6
)
ŒŒ6 7
;
ŒŒ7 8
using
œœ 
(
œœ 
var
œœ 
streamWriter
œœ #
=
œœ$ %
new
œœ& )
StreamWriter
œœ* 6
(
œœ6 7
memoryStream
œœ7 C
)
œœC D
)
œœD E
{
–– 
using
—— 
var
—— 
	csvWriter
—— #
=
——$ %
new
——& )
	CsvWriter
——* 3
(
——3 4
streamWriter
——4 @
)
——@ A
;
——A B
	csvWriter
““ 
.
““ 
WriteRecords
““ &
(
““& '
records
““' .
)
““. /
;
““/ 0
	csvWriter
”” 
.
”” 
WriteRecords
”” &
(
””& '
summedTotal
””' 2
)
””2 3
;
””3 4
}
‘‘ 
string
’’ 
fileName
’’ 
=
’’ 
$str
’’ 3
;
’’3 4
return
◊◊ 
File
◊◊ 
(
◊◊ 
memoryStream
◊◊ $
.
◊◊$ %
ToArray
◊◊% ,
(
◊◊, -
)
◊◊- .
,
◊◊. /
$str
◊◊0 J
,
◊◊J K
fileName
◊◊L T
)
◊◊T U
;
◊◊U V
}
ÿÿ 	
private
⁄⁄ 
SortedDictionary
⁄⁄  
<
⁄⁄  !
string
⁄⁄! '
,
⁄⁄' (
decimal
⁄⁄) 0
?
⁄⁄0 1
>
⁄⁄1 2 
GetServicesAndSums
⁄⁄3 E
(
⁄⁄E F
IEnumerable
⁄⁄F Q
<
⁄⁄Q R
Bill
⁄⁄R V
>
⁄⁄V W
bills
⁄⁄X ]
)
⁄⁄] ^
{
€€ 	
SortedDictionary
‹‹ 
<
‹‹ 
string
‹‹ #
,
‹‹# $
decimal
‹‹% ,
?
‹‹, -
>
‹‹- .
servicesAndSums
‹‹/ >
=
‹‹? @
new
‹‹A D
SortedDictionary
‹‹E U
<
‹‹U V
string
‹‹V \
,
‹‹\ ]
decimal
‹‹^ e
?
‹‹e f
>
‹‹f g
(
‹‹g h
)
‹‹h i
;
‹‹i j
foreach
ﬁﬁ 
(
ﬁﬁ 
Bill
ﬁﬁ 
bill
ﬁﬁ 
in
ﬁﬁ !
bills
ﬁﬁ" '
)
ﬁﬁ' (
{
ﬂﬂ 
ServiceCategory
‡‡ 
?
‡‡  
serviceCategory
‡‡! 0
=
‡‡1 2!
_categoryRepository
‡‡3 F
.
‡‡F G
GetById
‡‡G N
(
‡‡N O
bill
‡‡O S
.
‡‡S T
ServiceCategoryId
‡‡T e
)
‡‡e f
;
‡‡f g
if
·· 
(
·· 
serviceCategory
·· #
!=
··$ &
null
··' +
)
··+ ,
{
‚‚ 
if
„„ 
(
„„ 
servicesAndSums
„„ '
.
„„' (
ContainsKey
„„( 3
(
„„3 4
serviceCategory
„„4 C
.
„„C D
Name
„„D H
)
„„H I
)
„„I J
{
‰‰ 
servicesAndSums
ÂÂ '
[
ÂÂ' (
serviceCategory
ÂÂ( 7
.
ÂÂ7 8
Name
ÂÂ8 <
]
ÂÂ< =
+=
ÂÂ> @
bill
ÂÂA E
.
ÂÂE F
Amount
ÂÂF L
;
ÂÂL M
}
ÊÊ 
else
ÁÁ 
{
ËË 
servicesAndSums
ÈÈ '
.
ÈÈ' (
Add
ÈÈ( +
(
ÈÈ+ ,
!
ÈÈ, -
String
ÈÈ- 3
.
ÈÈ3 4
IsNullOrEmpty
ÈÈ4 A
(
ÈÈA B
serviceCategory
ÈÈB Q
.
ÈÈQ R
Name
ÈÈR V
)
ÈÈV W
?
ÈÈX Y
serviceCategory
ÈÈZ i
.
ÈÈi j
Name
ÈÈj n
:
ÍÍ 
$"
ÍÍ  
$str
ÍÍ  ;
{
ÍÍ; <
serviceCategory
ÍÍ< K
.
ÍÍK L
	ServiceId
ÍÍL U
}
ÍÍU V
$str
ÍÍV W
"
ÍÍW X
,
ÍÍX Y
bill
ÍÍZ ^
.
ÍÍ^ _
Amount
ÍÍ_ e
)
ÍÍe f
;
ÍÍf g
}
ÎÎ 
}
ÏÏ 
}
ÌÌ 
return
ÔÔ 
servicesAndSums
ÔÔ "
;
ÔÔ" #
}
 	
}
ÒÒ 
public
ÛÛ 

class
ÛÛ 
RecordEntry
ÛÛ 
{
ÙÙ 
public
ıı 
string
ıı 
ServiceCategory
ıı %
{
ıı& '
get
ıı( +
;
ıı+ ,
set
ıı- 0
;
ıı0 1
}
ıı2 3
public
ˆˆ 
decimal
ˆˆ 
?
ˆˆ 
Amount
ˆˆ 
{
ˆˆ  
get
ˆˆ! $
;
ˆˆ$ %
set
ˆˆ& )
;
ˆˆ) *
}
ˆˆ+ ,
public
˜˜ 
string
˜˜ 
UOM
˜˜ 
{
˜˜ 
get
˜˜ 
;
˜˜  
set
˜˜! $
;
˜˜$ %
}
˜˜& '
public
˘˘ 
RecordEntry
˘˘ 
(
˘˘ 
string
˘˘ !
serviceCategory
˘˘" 1
,
˘˘1 2
decimal
˘˘3 :
?
˘˘: ;
amount
˘˘< B
)
˘˘B C
{
˙˙ 	
ServiceCategory
˚˚ 
=
˚˚ 
serviceCategory
˚˚ -
;
˚˚- .
Amount
¸¸ 
=
¸¸ 
amount
¸¸ 
;
¸¸ 
}
˝˝ 	
}
˛˛ 
}ˇˇ ÕÓ
?C:\Repos\Service-Billing\Controllers\ClientAccountController.cs
	namespace 	
Service_Billing
 
. 
Controllers %
{ 
public 

class #
ClientAccountController (
:) *

Controller+ 5
{ 
private 
readonly $
IClientAccountRepository 1$
_clientAccountRepository2 J
;J K
private 
readonly !
IClientTeamRepository .!
_clientTeamRepository/ D
;D E
private 
readonly 
IMinistryRepository ,
_ministryRepository- @
;@ A
private 
readonly 
GraphServiceClient +
_graphServiceClient, ?
;? @
private 
readonly ?
3MicrosoftIdentityConsentAndConditionalAccessHandler L
_consentHandlerM \
;\ ]
private 
readonly 
ILogger  
<  !#
ClientAccountController! 8
>8 9
_logger: A
;A B
public #
ClientAccountController &
(& '
ILogger' .
<. /#
ClientAccountController/ F
>F G
loggerH N
,N O$
IClientAccountRepository $#
clientAccountRepository% <
,< =!
IClientTeamRepository ! 
clientTeamRepository" 6
,6 7
IMinistryRepository 
ministryRepository  2
,2 3
IConfiguration 
configuration (
,( )
GraphServiceClient .
graphServiceClient/ A
,A B?
3MicrosoftIdentityConsentAndConditionalAccessHandler O
consentHandlerP ^
)^ _
{ 	
_graphServiceClient 
=  !
graphServiceClient" 4
;4 5
_consentHandler   
=   
consentHandler   ,
;  , -$
_clientAccountRepository"" $
=""% &#
clientAccountRepository""' >
;""> ?!
_clientTeamRepository## !
=##" # 
clientTeamRepository##$ 8
;##8 9
_ministryRepository$$ 
=$$  !
ministryRepository$$" 4
;$$4 5
_logger%% 
=%% 
logger%% 
;%% 
}&& 	
public)) 
ActionResult)) 
Index)) !
())! "
string))" (
ministryFilter))) 7
,))7 8
int))9 <
numberFilter))= I
,))I J
string))K Q 
responsibilityFilter))R f
,))f g
string))h n
authorityFilter))o ~
,))~ 
string
))Ä Ü

teamFilter
))á ë
)
))ë í
{** 	
IEnumerable,, 
<,, 
Ministry,,  
>,,  !

ministries,," ,
=,,- .
_ministryRepository,,/ B
.,,B C
GetAll,,C I
(,,I J
),,J K
;,,K L
ViewData-- 
[-- 
$str-- !
]--! "
=--# $

ministries--% /
;--/ 0
ViewData.. 
[.. 
$str.. %
]..% &
=..' (
ministryFilter..) 7
;..7 8
ViewData// 
[// 
$str// #
]//# $
=//% &
numberFilter//' 3
;//3 4
ViewData00 
[00 
$str00 &
]00& '
=00( )
authorityFilter00* 9
;009 :
ViewData11 
[11 
$str11 +
]11+ ,
=11- . 
responsibilityFilter11/ C
;11C D
ViewData22 
[22 
$str22 !
]22! "
=22# $

teamFilter22% /
;22/ 0
IEnumerable33 
<33 
ClientAccount33 %
>33% &
clients33' .
=33/ 0
GetFilteredAccounts331 D
(33D E
ministryFilter33E S
,33S T
numberFilter33U a
,33a b 
responsibilityFilter33c w
,33w x
authorityFilter	33y à
,
33à â

teamFilter
33ä î
)
33î ï
;
33ï ñ
return55 
View55 
(55 
new55 "
ClientAccountViewModel55 2
(552 3
clients553 :
)55: ;
)55; <
;55< =
}66 	
public99 
ActionResult99 
Details99 #
(99# $
int99$ '
id99( *
)99* +
{:: 	
ClientAccount;; 
?;; 
account;; "
=;;# $$
_clientAccountRepository;;% =
.;;= >
GetClientAccount;;> N
(;;N O
id;;O Q
);;Q R
;;;R S
if<< 
(<< 
account<< 
==<< 
null<< 
)<<  
return== 
NotFound== 
(==  
)==  !
;==! "

ClientTeam>> 
?>> 
team>> 
=>> !
_clientTeamRepository>> 4
.>>4 5
GetTeamById>>5 @
(>>@ A
account>>A H
.>>H I
TeamId>>I O
)>>O P
;>>P Q
ViewData?? 
[?? 
$str?? !
]??! "
=??# $
team??% )
!=??* ,
null??- 1
???2 3
team??4 8
:??9 :
$str??; =
;??= >
return@@ 
View@@ 
(@@ 
account@@ 
)@@  
;@@  !
}AA 	
publicDD 
ActionResultDD 
EditDD  
(DD  !
intDD! $
idDD% '
)DD' (
{EE 	
varFF 
accountFF 
=FF $
_clientAccountRepositoryFF 2
.FF2 3
GetClientAccountFF3 C
(FFC D
idFFD F
)FFF G
;FFG H
ifGG 
(GG 
accountGG 
==GG 
nullGG 
)GG  
returnHH 
NotFoundHH 
(HH  
)HH  !
;HH! "
returnII 
ViewII 
(II 
accountII 
)II  
;II  !
}JJ 	
[MM 	
HttpPostMM	 
]MM 
[NN 	$
ValidateAntiForgeryTokenNN	 !
]NN! "
publicOO 
asyncOO 
TaskOO 
<OO 
IActionResultOO '
>OO' (
EditOO) -
(OO- .
intOO. 1
idOO2 4
,OO4 5
IFormCollectionOO6 E

collectionOOF P
)OOP Q
{PP 	
ifQQ 
(QQ 

ModelStateQQ 
.QQ 
IsValidQQ "
)QQ" #
{RR 
ClientAccountSS 
?SS 
accountToUpdateSS .
=SS/ 0$
_clientAccountRepositorySS1 I
.SSI J
GetClientAccountSSJ Z
(SSZ [
idSS[ ]
)SS] ^
;SS^ _
ifTT 
(TT 
accountToUpdateTT #
==TT$ &
nullTT' +
)TT+ ,
{UU 
returnVV 
NotFoundVV #
(VV# $
)VV$ %
;VV% &
}WW 
ifXX 
(XX 
awaitXX 
TryUpdateModelAsyncXX -
<XX- .
ClientAccountXX. ;
>XX; <
(XX< =
accountToUpdateXX= L
,XXL M
$strXXN P
,XXP Q
aYY 
=>YY 
aYY 
.YY 
NameYY 
,YY  
aZZ 
=>ZZ 
aZZ 
.ZZ 
ClientNumberZZ '
,ZZ' (
a[[ 
=>[[ 
a[[ 
.[[  
ResponsibilityCentre[[ /
,[[/ 0
a\\ 
=>\\ 
a\\ 
.\\ 
ServiceLine\\ &
,\\& '
a]] 
=>]] 
a]] 
.]] 
STOB]] 
,]]  
a^^ 
=>^^ 
a^^ 
.^^ 
Project^^ "
,^^" #
a__ 
=>__ 
a__ 
.__  
ExpenseAuthorityName__ /
,__/ 0
a`` 
=>`` 
a`` 
.`` 
ServicesEnabled`` *
)``* +
)``+ ,
{aa 
trybb 
{cc $
_clientAccountRepositorydd 0
.dd0 1
AddClientAccountdd1 A
(ddA B
accountToUpdateddB Q
)ddQ R
;ddR S
}ee 
catchff 
(ff 
DbUpdateExceptionff ,
)ff5 6
{gg 

ModelStatehh "
.hh" #
AddModelErrorhh# 0
(hh0 1
$strhh1 3
,hh3 4
$strhh5 O
+hhP Q
$strii F
+iiG H
$strjj <
)jj< =
;jj= >
}kk 
returnmm 
RedirectToActionmm +
(mm+ ,
nameofmm, 2
(mm2 3
Indexmm3 8
)mm8 9
)mm9 :
;mm: ;
}nn 
}oo 
returnqq 
Detailsqq 
(qq 
idqq 
)qq 
;qq 
}rr 	
publicuu 
ActionResultuu 
Deleteuu "
(uu" #
intuu# &
iduu' )
)uu) *
{vv 	
returnww 
Viewww 
(ww 
)ww 
;ww 
}xx 	
[{{ 	
HttpPost{{	 
]{{ 
[|| 	$
ValidateAntiForgeryToken||	 !
]||! "
public}} 
ActionResult}} 
Delete}} "
(}}" #
int}}# &
id}}' )
,}}) *
IFormCollection}}+ :

collection}}; E
)}}E F
{~~ 	
try 
{
ÄÄ 
return
ÅÅ 
RedirectToAction
ÅÅ '
(
ÅÅ' (
nameof
ÅÅ( .
(
ÅÅ. /
Index
ÅÅ/ 4
)
ÅÅ4 5
)
ÅÅ5 6
;
ÅÅ6 7
}
ÇÇ 
catch
ÉÉ 
{
ÑÑ 
return
ÖÖ 
View
ÖÖ 
(
ÖÖ 
)
ÖÖ 
;
ÖÖ 
}
ÜÜ 
}
áá 	
[
ââ 	
HttpGet
ââ	 
]
ââ 
public
ää 
ActionResult
ää 
Intake
ää "
(
ää" #
)
ää# $
{
ãã 	
_logger
åå 
.
åå 
LogInformation
åå "
(
åå" #
$str
åå# >
)
åå> ?
;
åå? @
IEnumerable
çç 
<
çç 
Ministry
çç  
>
çç  !

ministries
çç" ,
=
çç- .!
_ministryRepository
çç/ B
.
ççB C
GetAll
ççC I
(
ççI J
)
ççJ K
;
ççK L
ViewData
éé 
[
éé 
$str
éé !
]
éé! "
=
éé# $

ministries
éé% /
;
éé/ 0#
ClientIntakeViewModel
èè !
model
èè" '
=
èè( )
new
èè* -#
ClientIntakeViewModel
èè. C
(
èèC D
)
èèD E
;
èèE F
model
êê 
.
êê 
Account
êê 
.
êê 
ClientNumber
êê &
=
êê' (!
GetNextClientNumber
êê) <
(
êê< =
)
êê= >
;
êê> ?
return
ëë 
View
ëë 
(
ëë 
model
ëë 
)
ëë 
;
ëë 
}
íí 	
[
îî 	
HttpPost
îî	 
]
îî 
[
ïï 	&
ValidateAntiForgeryToken
ïï	 !
]
ïï! "
public
ññ 
async
ññ 
Task
ññ 
<
ññ 
IActionResult
ññ '
>
ññ' (
Intake
ññ) /
(
ññ/ 0#
ClientIntakeViewModel
ññ0 E
model
ññF K
)
ññK L
{
óó 	
_logger
òò 
.
òò 
LogInformation
òò "
(
òò" #
$str
òò# @
)
òò@ A
;
òòA B
try
ôô 
{
öö 
if
õõ 
(
õõ 

ModelState
õõ 
.
õõ 
IsValid
õõ &
)
õõ& '
{
úú 
_logger
ùù 
.
ùù 
LogInformation
ùù *
(
ùù* +
$str
ùù+ B
)
ùùB C
;
ùùC D
string
ûû 
accountName
ûû &
=
ûû' (
$"
ûû) +
{
ûû+ ,
model
ûû, 1
.
ûû1 2
MinistryAcronym
ûû2 A
}
ûûA B
$str
ûûB E
{
ûûE F
model
ûûF K
.
ûûK L
DivisionOrBranch
ûûL \
}
ûû\ ]
"
ûû] ^
;
ûû^ _
model
üü 
.
üü 
Account
üü !
.
üü! "
Name
üü" &
=
üü' (
accountName
üü) 4
;
üü4 5

ClientTeam
†† 
team
†† #
=
††$ %
model
††& +
.
††+ ,
Team
††, 0
;
††0 1
team
°° 
.
°° 
Name
°° 
=
°° 
$"
°°  "
{
°°" #
model
°°# (
.
°°( )
Account
°°) 0
.
°°0 1
Name
°°1 5
}
°°5 6
$str
°°6 ;
"
°°; <
;
°°< =
int
¢¢ 
teamId
¢¢ 
=
¢¢  #
_clientTeamRepository
¢¢! 6
.
¢¢6 7
Add
¢¢7 :
(
¢¢: ;
team
¢¢; ?
)
¢¢? @
;
¢¢@ A
ClientAccount
££ !
account
££" )
=
££* +
model
££, 1
.
££1 2
Account
££2 9
;
££9 :
account
§§ 
.
§§ 
TeamId
§§ "
=
§§# $
teamId
§§% +
;
§§+ ,
account
•• 
.
•• 

ClientTeam
•• &
=
••' (
team
••) -
.
••- .
Name
••. 2
;
••2 3
_logger
¶¶ 
.
¶¶ 
LogInformation
¶¶ *
(
¶¶* +
$"
¶¶+ -
$str
¶¶- O
{
¶¶O P
account
¶¶P W
.
¶¶W X
ClientNumber
¶¶X d
}
¶¶d e
$str
¶¶e z
"
¶¶z {
)
¶¶{ |
;
¶¶| }
int
ßß 
	accountId
ßß !
=
ßß" #&
_clientAccountRepository
ßß$ <
.
ßß< =
AddClientAccount
ßß= M
(
ßßM N
account
ßßN U
)
ßßU V
;
ßßV W
}
®® 
}
©© 
catch
™™ 
(
™™ 
DbUpdateException
™™ $
ex
™™% '
)
™™' (
{
´´ 
_logger
¨¨ 
.
¨¨ 
LogError
¨¨  
(
¨¨  !
$"
¨¨! #
$str
¨¨# W
{
¨¨W X
ex
¨¨X Z
.
¨¨Z [
InnerException
¨¨[ i
}
¨¨i j
"
¨¨j k
)
¨¨k l
;
¨¨l m
return
≠≠ 
View
≠≠ 
(
≠≠ 
new
≠≠ #
ClientIntakeViewModel
≠≠  5
(
≠≠5 6
)
≠≠6 7
)
≠≠7 8
;
≠≠8 9
}
ÆÆ 
catch
ØØ 
(
ØØ 
	Exception
ØØ 
ex
ØØ 
)
ØØ 
{
∞∞ 
_logger
±± 
.
±± 
LogError
±±  
(
±±  !
$"
±±! #
$str
±±# Z
{
±±Z [
ex
±±[ ]
.
±±] ^
InnerException
±±^ l
}
±±l m
"
±±m n
)
±±n o
;
±±o p
}
≤≤ 
return
¥¥ 
RedirectToAction
¥¥ #
(
¥¥# $
nameof
¥¥$ *
(
¥¥* +
Index
¥¥+ 0
)
¥¥0 1
)
¥¥1 2
;
¥¥2 3
}
µµ 	
private
∑∑ 
short
∑∑ !
GetNextClientNumber
∑∑ )
(
∑∑) *
)
∑∑* +
{
∏∏ 	
short
ππ 
ret
ππ 
=
ππ 
$num
ππ 
;
ππ 
IEnumerable
∫∫ 
<
∫∫ 
ClientAccount
∫∫ %
>
∫∫% &
accounts
∫∫' /
=
∫∫0 1&
_clientAccountRepository
∫∫2 J
.
∫∫J K
GetAll
∫∫K Q
(
∫∫Q R
)
∫∫R S
;
∫∫S T
if
ªª 
(
ªª 
accounts
ªª 
!=
ªª 
null
ªª  
&&
ªª! #
accounts
ªª$ ,
.
ªª, -
Any
ªª- 0
(
ªª0 1
)
ªª1 2
)
ªª2 3
{
ºº 
ret
ΩΩ 
=
ΩΩ 
(
ΩΩ 
short
ΩΩ 
)
ΩΩ 
accounts
ΩΩ %
.
ΩΩ% &
Count
ΩΩ& +
(
ΩΩ+ ,
)
ΩΩ, -
;
ΩΩ- .
while
øø 
(
øø 
accounts
øø 
.
øø  
FirstOrDefault
øø  .
(
øø. /
a
øø/ 0
=>
øø1 3
a
øø4 5
.
øø5 6
ClientNumber
øø6 B
==
øøC E
ret
øøF I
)
øøI J
!=
øøK M
null
øøN R
)
øøR S
ret
¿¿ 
++
¿¿ 
;
¿¿ 
}
¡¡ 
return
√√ 
ret
√√ 
;
√√ 
}
ƒƒ 	
[
∆∆ 	
HttpGet
∆∆	 
]
∆∆ 
[
«« 	 
AuthorizeForScopes
««	 
(
«« 
ScopeKeySection
«« +
=
««, -
$str
««. D
)
««D E
]
««E F
public
»» 
async
»» 
Task
»» 
<
»» 
IActionResult
»» '
>
»»' (
SearchForContact
»») 9
(
»»9 :
string
»»: @
query
»»A F
,
»»F G
string
»»H N
contactType
»»O Z
,
»»Z [#
ClientIntakeViewModel
»»\ q
model
»»r w
)
»»w x
{
…… 	
try
   
{
ÀÀ 
var
ÃÃ 
queriedUsers
ÃÃ  
=
ÃÃ! "
await
ÃÃ# (!
_graphServiceClient
ÃÃ) <
.
ÃÃ< =
Users
ÃÃ= B
.
ÃÃB C
Request
ÃÃC J
(
ÃÃJ K
)
ÃÃK L
.
ÕÕ 
Filter
ÕÕ 
(
ÕÕ 
$"
ÕÕ 
$str
ÕÕ 7
{
ÕÕ7 8
query
ÕÕ8 =
}
ÕÕ= >
$str
ÕÕ> @
"
ÕÕ@ A
)
ÕÕA B
.
ŒŒ 
Top
ŒŒ 
(
ŒŒ 
$num
ŒŒ 
)
ŒŒ 
.
œœ 
Select
œœ 
(
œœ 
$str
œœ -
)
œœ- .
.
–– 
GetAsync
–– 
(
–– 
)
–– 
;
––  
List
““ 
<
““ 
SelectListItem
““ #
>
““# $
contactItems
““% 1
=
““2 3
new
““4 7
List
““8 <
<
““< =
SelectListItem
““= K
>
““K L
(
““L M
)
““M N
;
““N O
foreach
”” 
(
”” 
var
”” 
user
”” !
in
””" $
queriedUsers
””% 1
)
””1 2
{
‘‘ 
contactItems
’’  
.
’’  !
Add
’’! $
(
’’$ %
new
’’% (
SelectListItem
’’) 7
(
’’7 8
user
’’8 <
.
’’< =
DisplayName
’’= H
,
’’H I
user
’’J N
.
’’N O
DisplayName
’’O Z
)
’’Z [
)
’’[ \
;
’’\ ]
}
÷÷ 
model
ÿÿ 
.
ÿÿ 
Contacts
ÿÿ 
=
ÿÿ  
contactItems
ÿÿ! -
;
ÿÿ- .
return
⁄⁄ 
ViewComponent
⁄⁄ $
(
⁄⁄$ %
$str
⁄⁄% 4
,
⁄⁄4 5
new
⁄⁄6 9
{
⁄⁄: ;
	elementId
⁄⁄< E
=
⁄⁄F G
contactType
⁄⁄H S
.
⁄⁄S T
Replace
⁄⁄T [
(
⁄⁄[ \
$str
⁄⁄\ d
,
⁄⁄d e
$str
⁄⁄f m
)
⁄⁄m n
,
⁄⁄n o
contactList
⁄⁄p {
=
⁄⁄| }
contactItems⁄⁄~ ä
,⁄⁄ä ã
model⁄⁄å ë
=⁄⁄í ì
model⁄⁄î ô
}⁄⁄ö õ
)⁄⁄õ ú
;⁄⁄ú ù
}
€€ 
catch
‹‹ 
(
‹‹ 
	Exception
‹‹ 
ex
‹‹ 
)
‹‹  
{
›› 
return
ﬁﬁ 
new
ﬁﬁ 

JsonResult
ﬁﬁ %
(
ﬁﬁ% &
ex
ﬁﬁ& (
.
ﬁﬁ( )
InnerException
ﬁﬁ) 7
)
ﬁﬁ7 8
;
ﬁﬁ8 9
}
ﬂﬂ 
}
‡‡ 	
public
‚‚ 
async
‚‚ 
Task
‚‚ 
<
‚‚ 
IActionResult
‚‚ '
>
‚‚' (!
CurrentUserAccounts
‚‚) <
(
‚‚< =
)
‚‚= >
{
„„ 	
User
‰‰ 
currentUser
‰‰ 
=
‰‰ !
_graphServiceClient
‰‰ 2
.
‰‰2 3
Me
‰‰3 5
.
‰‰5 6
Request
‰‰6 =
(
‰‰= >
)
‰‰> ?
.
‰‰? @
GetAsync
‰‰@ H
(
‰‰H I
)
‰‰I J
.
‰‰J K
Result
‰‰K Q
;
‰‰Q R
IEnumerable
ÂÂ 
<
ÂÂ 
ClientAccount
ÂÂ %
>
ÂÂ% &!
currentUserAccounts
ÂÂ' :
=
ÂÂ; <&
_clientAccountRepository
ÂÂ= U
.
ÂÂU V&
GetAccountsByContactName
ÂÂV n
(
ÂÂn o
currentUser
ÂÂo z
.
ÂÂz {
DisplayNameÂÂ{ Ü
)ÂÂÜ á
;ÂÂá à
return
ÁÁ 
View
ÁÁ 
(
ÁÁ 
$str
ÁÁ 
,
ÁÁ  
new
ÁÁ! $$
ClientAccountViewModel
ÁÁ% ;
(
ÁÁ; <!
currentUserAccounts
ÁÁ< O
)
ÁÁO P
)
ÁÁP Q
;
ÁÁQ R
}
ËË 	
private
ÍÍ 
IEnumerable
ÍÍ 
<
ÍÍ 
ClientAccount
ÍÍ )
>
ÍÍ) *!
GetFilteredAccounts
ÍÍ+ >
(
ÍÍ> ?
string
ÍÍ? E
ministryFilter
ÍÍF T
,
ÍÍT U
int
ÍÍV Y
numberFilter
ÍÍZ f
,
ÍÍf g
string
ÍÍh n#
responsibilityFilterÍÍo É
,ÍÍÉ Ñ
stringÍÍÖ ã
authorityFilterÍÍå õ
,ÍÍõ ú
stringÍÍù £

teamFilterÍÍ§ Æ
)ÍÍÆ Ø
{
ÎÎ 	
IEnumerable
ÏÏ 
<
ÏÏ 
ClientAccount
ÏÏ %
>
ÏÏ% &
clients
ÏÏ' .
=
ÏÏ/ 0&
_clientAccountRepository
ÏÏ1 I
.
ÏÏI J
GetAll
ÏÏJ P
(
ÏÏP Q
)
ÏÏQ R
;
ÏÏR S
if
ÌÌ 
(
ÌÌ 
!
ÌÌ 
String
ÌÌ 
.
ÌÌ 
IsNullOrEmpty
ÌÌ %
(
ÌÌ% &
ministryFilter
ÌÌ& 4
)
ÌÌ4 5
)
ÌÌ5 6
clients
ÓÓ 
=
ÓÓ 
clients
ÓÓ !
.
ÓÓ! "
Where
ÓÓ" '
(
ÓÓ' (
x
ÓÓ( )
=>
ÓÓ* ,
!
ÓÓ- .
String
ÓÓ. 4
.
ÓÓ4 5
IsNullOrEmpty
ÓÓ5 B
(
ÓÓB C
x
ÓÓC D
.
ÓÓD E
Name
ÓÓE I
)
ÓÓI J
&&
ÓÓK M
x
ÓÓN O
.
ÓÓO P
Name
ÓÓP T
.
ÓÓT U
Contains
ÓÓU ]
(
ÓÓ] ^
ministryFilter
ÓÓ^ l
)
ÓÓl m
)
ÓÓm n
;
ÓÓn o
if
ÔÔ 
(
ÔÔ 
numberFilter
ÔÔ 
>
ÔÔ 
$num
ÔÔ  
)
ÔÔ  !
clients
 
=
 
clients
 !
.
! "
Where
" '
(
' (
x
( )
=>
* ,
x
- .
.
. /
ClientNumber
/ ;
==
< >
numberFilter
? K
)
K L
.
L M
ToList
M S
(
S T
)
T U
;
U V
if
ÒÒ 
(
ÒÒ 
!
ÒÒ 
String
ÒÒ 
.
ÒÒ 
IsNullOrEmpty
ÒÒ %
(
ÒÒ% &"
responsibilityFilter
ÒÒ& :
)
ÒÒ: ;
)
ÒÒ; <
clients
ÚÚ 
=
ÚÚ 
clients
ÚÚ !
.
ÚÚ! "
Where
ÚÚ" '
(
ÚÚ' (
x
ÚÚ( )
=>
ÚÚ* ,
!
ÚÚ- .
String
ÚÚ. 4
.
ÚÚ4 5
IsNullOrEmpty
ÚÚ5 B
(
ÚÚB C
x
ÚÚC D
.
ÚÚD E"
ResponsibilityCentre
ÚÚE Y
)
ÚÚY Z
&&
ÚÚ[ ]
x
ÚÚ^ _
.
ÚÚ_ `"
ResponsibilityCentre
ÚÚ` t
.
ÚÚt u
ToLower
ÚÚu |
(
ÚÚ| }
)
ÚÚ} ~
.
ÚÚ~ 
ContainsÚÚ á
(ÚÚá à$
responsibilityFilterÚÚà ú
.ÚÚú ù
ToLowerÚÚù §
(ÚÚ§ •
)ÚÚ• ¶
)ÚÚ¶ ß
)ÚÚß ®
;ÚÚ® ©
if
ÛÛ 
(
ÛÛ 
!
ÛÛ 
String
ÛÛ 
.
ÛÛ 
IsNullOrEmpty
ÛÛ %
(
ÛÛ% &
authorityFilter
ÛÛ& 5
)
ÛÛ5 6
)
ÛÛ6 7
clients
ÙÙ 
=
ÙÙ 
clients
ÙÙ !
.
ÙÙ! "
Where
ÙÙ" '
(
ÙÙ' (
x
ÙÙ( )
=>
ÙÙ* ,
!
ÙÙ- .
String
ÙÙ. 4
.
ÙÙ4 5
IsNullOrEmpty
ÙÙ5 B
(
ÙÙB C
x
ÙÙC D
.
ÙÙD E"
ExpenseAuthorityName
ÙÙE Y
)
ÙÙY Z
&&
ÙÙ[ ]
x
ÙÙ^ _
.
ÙÙ_ `"
ExpenseAuthorityName
ÙÙ` t
.
ÙÙt u
ToLower
ÙÙu |
(
ÙÙ| }
)
ÙÙ} ~
.
ÙÙ~ 
ContainsÙÙ á
(ÙÙá à
authorityFilterÙÙà ó
.ÙÙó ò
ToLowerÙÙò ü
(ÙÙü †
)ÙÙ† °
)ÙÙ° ¢
)ÙÙ¢ £
;ÙÙ£ §
if
ıı 
(
ıı 
!
ıı 
String
ıı 
.
ıı 
IsNullOrEmpty
ıı %
(
ıı% &

teamFilter
ıı& 0
)
ıı0 1
)
ıı1 2
clients
ˆˆ 
=
ˆˆ 
clients
ˆˆ !
.
ˆˆ! "
Where
ˆˆ" '
(
ˆˆ' (
x
ˆˆ( )
=>
ˆˆ* ,
!
ˆˆ- .
String
ˆˆ. 4
.
ˆˆ4 5
IsNullOrEmpty
ˆˆ5 B
(
ˆˆB C
x
ˆˆC D
.
ˆˆD E

ClientTeam
ˆˆE O
)
ˆˆO P
&&
ˆˆQ S
x
ˆˆT U
.
ˆˆU V

ClientTeam
ˆˆV `
.
ˆˆ` a
ToLower
ˆˆa h
(
ˆˆh i
)
ˆˆi j
.
ˆˆj k
Contains
ˆˆk s
(
ˆˆs t

teamFilter
ˆˆt ~
.
ˆˆ~ 
ToLowerˆˆ Ü
(ˆˆÜ á
)ˆˆá à
)ˆˆà â
)ˆˆâ ä
;ˆˆä ã
return
¯¯ 
clients
¯¯ 
;
¯¯ 
}
˘˘ 	
[
˚˚ 	
HttpGet
˚˚	 
]
˚˚ 
public
¸¸ 
async
¸¸ 
Task
¸¸ 
<
¸¸ 
IActionResult
¸¸ '
>
¸¸' (

WriteToCSV
¸¸) 3
(
¸¸3 4
string
¸¸4 :
ministryFilter
¸¸; I
,
¸¸I J
int
¸¸K N
numberFilter
¸¸O [
,
¸¸[ \
string
¸¸] c"
responsibilityFilter
¸¸d x
,
¸¸x y
string¸¸z Ä
authorityFilter¸¸Å ê
,¸¸ê ë
string¸¸í ò

teamFilter¸¸ô £
)¸¸£ §
{
˝˝ 	
IEnumerable
˛˛ 
<
˛˛ 
ClientAccount
˛˛ %
>
˛˛% &
accounts
˛˛' /
=
˛˛0 1!
GetFilteredAccounts
˛˛2 E
(
˛˛E F
ministryFilter
˛˛F T
,
˛˛T U
numberFilter
˛˛V b
,
˛˛b c"
responsibilityFilter
˛˛d x
,
˛˛x y
authorityFilter˛˛z â
,˛˛â ä

teamFilter˛˛ã ï
)˛˛ï ñ
;˛˛ñ ó
try
ˇˇ 
{
ÄÄ 
using
ÅÅ 
var
ÅÅ 
memoryStream
ÅÅ &
=
ÅÅ' (
new
ÅÅ) ,
MemoryStream
ÅÅ- 9
(
ÅÅ9 :
)
ÅÅ: ;
;
ÅÅ; <
using
ÇÇ 
(
ÇÇ 
var
ÇÇ 
streamWriter
ÇÇ '
=
ÇÇ( )
new
ÇÇ* -
StreamWriter
ÇÇ. :
(
ÇÇ: ;
memoryStream
ÇÇ; G
)
ÇÇG H
)
ÇÇH I
{
ÉÉ 
using
ÑÑ 
var
ÑÑ 
	csvWriter
ÑÑ '
=
ÑÑ( )
new
ÑÑ* -
	CsvWriter
ÑÑ. 7
(
ÑÑ7 8
streamWriter
ÑÑ8 D
)
ÑÑD E
;
ÑÑE F
	csvWriter
ÖÖ 
.
ÖÖ 
WriteRecords
ÖÖ *
(
ÖÖ* +
accounts
ÖÖ+ 3
)
ÖÖ3 4
;
ÖÖ4 5
}
ÜÜ 
string
áá 
fileName
áá 
=
áá  !
$str
áá" 3
;
áá3 4
if
àà 
(
àà 
!
àà 
String
àà 
.
àà 
IsNullOrEmpty
àà )
(
àà) *
ministryFilter
àà* 8
)
àà8 9
)
àà9 :
fileName
ââ 
+=
ââ 
$"
ââ  "
$str
ââ" )
{
ââ) *
numberFilter
ââ* 6
}
ââ6 7
"
ââ7 8
;
ââ8 9
if
ää 
(
ää 
!
ää 
String
ää 
.
ää 
IsNullOrEmpty
ää )
(
ää) *"
responsibilityFilter
ää* >
)
ää> ?
)
ää? @
fileName
ãã 
+=
ãã 
$"
ãã  "
$str
ãã" #
{
ãã# $"
responsibilityFilter
ãã$ 8
}
ãã8 9
"
ãã9 :
;
ãã: ;
if
åå 
(
åå 
!
åå 
String
åå 
.
åå 
IsNullOrEmpty
åå )
(
åå) *
authorityFilter
åå* 9
)
åå9 :
)
åå: ;
fileName
çç 
+=
çç 
$"
çç  "
$str
çç" #
{
çç# $
authorityFilter
çç$ 3
}
çç3 4
"
çç4 5
;
çç5 6
if
éé 
(
éé 
!
éé 
String
éé 
.
éé 
IsNullOrEmpty
éé )
(
éé) *

teamFilter
éé* 4
)
éé4 5
)
éé5 6
fileName
èè 
+=
èè 
$"
èè  "
$str
èè" #
{
èè# $

teamFilter
èè$ .
}
èè. /
"
èè/ 0
;
èè0 1
fileName
íí 
+=
íí 
DateTime
íí $
.
íí$ %
Today
íí% *
.
íí* +
ToString
íí+ 3
(
íí3 4
$str
íí4 @
)
íí@ A
;
ííA B
fileName
ìì 
+=
ìì 
$str
ìì "
;
ìì" #
return
ïï 
File
ïï 
(
ïï 
memoryStream
ïï (
.
ïï( )
ToArray
ïï) 0
(
ïï0 1
)
ïï1 2
,
ïï2 3
$str
ïï4 N
,
ïïN O
fileName
ïïP X
)
ïïX Y
;
ïïY Z
}
ññ 
catch
óó 
(
óó 
	Exception
óó 
ex
óó 
)
óó  
{
òò 
return
öö 

StatusCode
öö !
(
öö! "
$num
öö" %
)
öö% &
;
öö& '
}
õõ 
}
úú 	
}
ùù 
}ûû Á
6C:\Repos\Service-Billing\Controllers\HomeController.cs
	namespace 	
Service_Billing
 
. 
Controllers %
;% &
[ 
	Authorize 

]
 
public 
class 
HomeController 
: 

Controller (
{ 
private 
readonly 
ILogger 
< 
HomeController +
>+ ,
_logger- 4
;4 5
private 
readonly 
GraphServiceClient '
_graphServiceClient( ;
;; <
private 
readonly ?
3MicrosoftIdentityConsentAndConditionalAccessHandler H
_consentHandlerI X
;X Y
private!! 
string!! 
[!! 
]!! 
_graphScopes!! !
=!!" #
{!!$ %
$str!!& 1
}!!2 3
;!!3 4
public## 

HomeController## 
(## 
ILogger## !
<##! "
HomeController##" 0
>##0 1
logger##2 8
,##8 9
IConfiguration$$
 
configuration$$ &
,$$& '
GraphServiceClient%% .
graphServiceClient%%/ A
,%%A B?
3MicrosoftIdentityConsentAndConditionalAccessHandler&& O
consentHandler&&P ^
)&&^ _
{'' 
_logger(( 
=(( 
logger(( 
;(( 
_graphServiceClient)) 
=)) 
graphServiceClient)) 0
;))0 1
_consentHandler** 
=** 
consentHandler** (
;**( )
}// 
[11 
	Authorize11 
]11 
[22 
	Authorize22 
(22 
Roles22 
=22 
$str22 l
)22l m
]22m n
public33 

IActionResult33 
Index33 
(33 
)33  
{44 
return55 
View55 
(55 
)55 
;55 
}66 
public88 

IActionResult88 
Privacy88  
(88  !
)88! "
{99 
return:: 
View:: 
(:: 
):: 
;:: 
};; 
[== 
AllowAnonymous== 
]== 
[>> 
ResponseCache>> 
(>> 
Duration>> 
=>> 
$num>> 
,>>  
Location>>! )
=>>* +!
ResponseCacheLocation>>, A
.>>A B
None>>B F
,>>F G
NoStore>>H O
=>>P Q
true>>R V
)>>V W
]>>W X
public?? 

IActionResult?? 
Error?? 
(?? 
)??  
{@@ 
returnAA 
ViewAA 
(AA 
newAA 
ErrorViewModelAA &
{AA' (
	RequestIdAA) 2
=AA3 4
ActivityAA5 =
.AA= >
CurrentAA> E
?AAE F
.AAF G
IdAAG I
??AAJ L
HttpContextAAM X
.AAX Y
TraceIdentifierAAY h
}AAi j
)AAj k
;AAk l
}BB 
}CC —{
AC:\Repos\Service-Billing\Controllers\ServiceCategoryController.cs
	namespace 	
Service_Billing
 
. 
Controllers %
{ 
public 

class %
ServiceCategoryController *
:* +

Controller, 6
{ 
private 
readonly &
IServiceCategoryRepository 3
_categoryRepository4 G
;G H
private 
readonly 
ILogger  
<  !%
ServiceCategoryController! :
>: ;
_logger< C
;C D
public %
ServiceCategoryController (
(( )
ILogger) 0
<0 1%
ServiceCategoryController1 J
>J K
loggerL R
,R S&
IServiceCategoryRepositoryT n
categoryRepository	o Å
)
Å Ç
{ 	
_categoryRepository 
=  !
categoryRepository" 4
;4 5
_logger 
= 
logger 
; 
} 	
public 
IActionResult 
Index "
(" #
string# )

areaFilter* 4
,4 5
string6 <

nameFilter= G
,G H
stringI O
activeFilterP \
,\ ]
string^ d
	uomFiltere n
,n o
stringp v
ownerFilter	w Ç
)
Ç É
{ 	
ViewData 
[ 
$str !
]! "
=# $

areaFilter% /
;/ 0
ViewData 
[ 
$str !
]! "
=# $

nameFilter% /
;/ 0
ViewData 
[ 
$str %
]% &
=' (
activeFilter) 5
;5 6
ViewData 
[ 
$str  
]  !
=" #
	uomFilter$ -
;- .
ViewData   
[   
$str   "
]  " #
=  $ %
ownerFilter  & 1
;  1 2
IEnumerable!! 
<!! 
ServiceCategory!! '
>!!' (

categories!!) 3
=!!4 5
_categoryRepository!!6 I
.!!I J
GetAll!!J P
(!!P Q
)!!Q R
;!!R S
List"" 
<"" 
string"" 
>"" 
busAreas"" !
=""" #
new""$ '
List""( ,
<"", -
string""- 3
>""3 4
(""4 5
)""5 6
;""6 7
if## 
(## 

categories## 
!=## 
null## !
&&##" $

categories##% /
.##/ 0
Any##0 3
(##3 4
)##4 5
)##5 6
{$$ 
foreach%% 
(%% 
ServiceCategory%% '
category%%( 0
in%%1 3

categories%%4 >
)%%> ?
{&& 
if'' 
('' 
!'' 
String'' 
.'' 
IsNullOrEmpty'' ,
('', -
category''- 5
.''5 6

GDXBusArea''6 @
)''@ A
&&''B D
!''E F
busAreas''F N
.''N O
Contains''O W
(''W X
category''X `
.''` a

GDXBusArea''a k
)''k l
)''l m
busAreas((  
.((  !
Add((! $
((($ %
category((% -
.((- .

GDXBusArea((. 8
)((8 9
;((9 :
})) 
}** 
ViewData,, 
[,, 
$str,, 
],,  
=,,! "
busAreas,,# +
;,,+ ,

categories-- 
=-- !
GetFilteredCategories-- .
(--. /

areaFilter--/ 9
,--9 :

nameFilter--; E
,--E F
activeFilter--G S
,--S T
	uomFilter--U ^
,--^ _
ownerFilter--` k
)--k l
;--l m
return// 
View// 
(// 

categories// "
)//" #
;//# $
}00 	
[22 	
HttpGet22	 
]22 
public33 
IActionResult33 
Edit33 !
(33! "
int33" %
id33& (
)33( )
{44 	
ServiceCategory55 
?55 
serviceCategory55 ,
=55- .
_categoryRepository55/ B
.55B C
GetById55C J
(55J K
id55K M
)55M N
;55N O
if66 
(66 
serviceCategory66 
==66  "
null66# '
)66' (
{77 
return88 
NotFound88 
(88  
)88  !
;88! "
}99 
return;; 
View;; 
(;; 
serviceCategory;; '
);;' (
;;;( )
}<< 	
[>> 	
HttpPost>>	 
]>> 
public?? 
IActionResult?? 
Edit?? !
(??! "
ServiceCategory??" 1
serviceCategory??2 A
)??A B
{@@ 	
tryAA 
{BB 
_categoryRepositoryCC #
.CC# $
UpdateCC$ *
(CC* +
serviceCategoryCC+ :
)CC: ;
;CC; <
}DD 
catchEE 
(EE 
DbUpdateExceptionEE $
exEE% '
)EE' (
{FF 
}HH 
IEnumerableII 
<II 
ServiceCategoryII '
>II' (

categoriesII) 3
=II4 5
_categoryRepositoryII6 I
.III J
GetAllIIJ P
(IIP Q
)IIQ R
;IIR S
returnJJ 
ViewJJ 
(JJ 
$strJJ 
,JJ  

categoriesJJ! +
)JJ+ ,
;JJ, -
}KK 	
[MM 	
HttpGetMM	 
]MM 
publicNN 
IActionResultNN 
CreateNN #
(NN# $
)NN$ %
{OO 	
returnQQ 
ViewQQ 
(QQ 
)QQ 
;QQ 
}RR 	
[TT 	
HttpPostTT	 
]TT 
publicUU 
IActionResultUU 
CreateUU #
(UU# $
ServiceCategoryUU$ 3
serviceCategoryUU4 C
)UUC D
{VV 	
tryWW 
{XX 
intYY 
idYY 
=YY 
_categoryRepositoryYY +
.YY+ ,
AddYY, /
(YY/ 0
serviceCategoryYY0 ?
)YY? @
;YY@ A
}ZZ 
catch[[ 
([[ 
DbUpdateException[[ $
ex[[% '
)[[' (
{\\ 
}^^ 
IEnumerable__ 
<__ 
ServiceCategory__ '
>__' (

categories__) 3
=__4 5
_categoryRepository__6 I
.__I J
GetAll__J P
(__P Q
)__Q R
;__R S
return`` 
View`` 
(`` 
$str`` 
,``  

categories``! +
)``+ ,
;``, -
}aa 	
[cc 	
HttpPostcc	 
]cc 
publicdd 
IActionResultdd 
Deletedd #
(dd# $
ServiceCategorydd$ 3
serviceCategorydd4 C
)ddC D
{ee 	
returngg 
Viewgg 
(gg 
$strgg 
)gg  
;gg  !
}hh 	
[jj 	
HttpGetjj	 
]jj 
publickk 
asynckk 
Taskkk 
<kk 
IActionResultkk '
>kk' (

WriteToCSVkk) 3
(kk3 4
stringkk4 :

areaFilterkk; E
,kkE F
stringkkG M

nameFilterkkN X
,kkX Y
stringkkZ `
activeFilterkka m
,kkm n
stringkko u
	uomFilterkkv 
,	kk Ä
string
kkÅ á
ownerFilter
kkà ì
)
kkì î
{ll 	
IEnumerablemm 
<mm 
ServiceCategorymm '
>mm' (

categoriesmm) 3
=mm4 5!
GetFilteredCategoriesmm6 K
(mmK L

areaFiltermmL V
,mmV W

nameFiltermmX b
,mmb c
activeFiltermmd p
,mmp q
	uomFiltermmr {
,mm{ |
ownerFilter	mm} à
)
mmà â
;
mmâ ä
trynn 
{oo 
usingpp 
varpp 
memoryStreampp &
=pp' (
newpp) ,
MemoryStreampp- 9
(pp9 :
)pp: ;
;pp; <
usingqq 
(qq 
varqq 
streamWriterqq '
=qq( )
newqq* -
StreamWriterqq. :
(qq: ;
memoryStreamqq; G
)qqG H
)qqH I
{rr 
usingss 
varss 
	csvWriterss '
=ss( )
newss* -
	CsvWriterss. 7
(ss7 8
streamWriterss8 D
)ssD E
;ssE F
	csvWritertt 
.tt 
WriteRecordstt *
(tt* +

categoriestt+ 5
)tt5 6
;tt6 7
}uu 
stringvv 
fileNamevv 
=vv  !
$strvv" 6
;vv6 7
ifww 
(ww 
!ww 
Stringww 
.ww 
IsNullOrEmptyww )
(ww) *

areaFilterww* 4
)ww4 5
)ww5 6
fileNamexx 
+=xx 
$"xx  "
$strxx" #
{xx# $

areaFilterxx$ .
}xx. /
"xx/ 0
;xx0 1
ifyy 
(yy 
!yy 
Stringyy 
.yy 
IsNullOrEmptyyy )
(yy) *

nameFilteryy* 4
)yy4 5
)yy5 6
fileNamezz 
+=zz 
$"zz  "
$strzz" #
{zz# $

nameFilterzz$ .
}zz. /
"zz/ 0
;zz0 1
if{{ 
({{ 
!{{ 
String{{ 
.{{ 
IsNullOrEmpty{{ )
({{) *
activeFilter{{* 6
){{6 7
){{7 8
fileName|| 
+=|| 
$"||  "
$str||" #
{||# $
activeFilter||$ 0
}||0 1
"||1 2
;||2 3
if}} 
(}} 
!}} 
String}} 
.}} 
IsNullOrEmpty}} )
(}}) *
	uomFilter}}* 3
)}}3 4
)}}4 5
fileName~~ 
+=~~ 
$"~~  "
$str~~" #
{~~# $
	uomFilter~~$ -
}~~- .
"~~. /
;~~/ 0
if 
( 
! 
String 
. 
IsNullOrEmpty )
() *
ownerFilter* 5
)5 6
)6 7
fileName
ÄÄ 
+=
ÄÄ 
$"
ÄÄ  "
$str
ÄÄ" #
{
ÄÄ# $
ownerFilter
ÄÄ$ /
}
ÄÄ/ 0
"
ÄÄ0 1
;
ÄÄ1 2
fileName
ÇÇ 
+=
ÇÇ 
DateTime
ÇÇ $
.
ÇÇ$ %
Today
ÇÇ% *
.
ÇÇ* +
ToString
ÇÇ+ 3
(
ÇÇ3 4
$str
ÇÇ4 @
)
ÇÇ@ A
;
ÇÇA B
fileName
ÉÉ 
+=
ÉÉ 
$str
ÉÉ "
;
ÉÉ" #
return
ÖÖ 
File
ÖÖ 
(
ÖÖ 
memoryStream
ÖÖ (
.
ÖÖ( )
ToArray
ÖÖ) 0
(
ÖÖ0 1
)
ÖÖ1 2
,
ÖÖ2 3
$str
ÖÖ4 N
,
ÖÖN O
fileName
ÖÖP X
)
ÖÖX Y
;
ÖÖY Z
}
ÜÜ 
catch
áá 
(
áá 
	Exception
áá 
ex
áá 
)
áá  
{
àà 
return
ää 

StatusCode
ää !
(
ää! "
$num
ää" %
)
ää% &
;
ää& '
}
ãã 
}
åå 	
private
éé 
IEnumerable
éé 
<
éé 
ServiceCategory
éé +
>
éé+ ,#
GetFilteredCategories
éé- B
(
ééB C
string
ééC I

areaFilter
ééJ T
,
ééT U
string
ééV \

nameFilter
éé] g
,
éég h
string
ééi o
activeFilter
éép |
,
éé| }
stringéé~ Ñ
	uomFilterééÖ é
,ééé è
stringééê ñ
ownerFilterééó ¢
)éé¢ £
{
èè 	
IEnumerable
êê 
<
êê 
ServiceCategory
êê '
>
êê' (

categories
êê) 3
=
êê4 5!
_categoryRepository
êê6 I
.
êêI J
GetAll
êêJ P
(
êêP Q
)
êêQ R
;
êêR S
if
ëë 
(
ëë 
!
ëë 
String
ëë 
.
ëë 
IsNullOrEmpty
ëë %
(
ëë% &

areaFilter
ëë& 0
)
ëë0 1
)
ëë1 2

categories
íí 
=
íí 

categories
íí '
.
íí' (
Where
íí( -
(
íí- .
x
íí. /
=>
íí0 2
x
íí3 4
.
íí4 5

GDXBusArea
íí5 ?
==
íí@ B

areaFilter
ííC M
)
ííM N
;
ííN O
if
ìì 
(
ìì 
!
ìì 
String
ìì 
.
ìì 
IsNullOrEmpty
ìì %
(
ìì% &

nameFilter
ìì& 0
)
ìì0 1
)
ìì1 2

categories
îî 
=
îî 

categories
îî '
.
îî' (
Where
îî( -
(
îî- .
x
îî. /
=>
îî0 2
x
îî3 4
.
îî4 5
Name
îî5 9
==
îî: <

nameFilter
îî= G
)
îîG H
;
îîH I
if
ïï 
(
ïï 
activeFilter
ïï 
!=
ïï 
null
ïï  $
)
ïï$ %
{
ññ 
if
óó 
(
óó 
activeFilter
óó  
==
óó! #
$str
óó$ ,
)
óó, -

categories
òò 
=
òò  

categories
òò! +
.
òò+ ,
Where
òò, 1
(
òò1 2
x
òò2 3
=>
òò4 6
x
òò7 8
.
òò8 9
IsActive
òò9 A
==
òòB D
true
òòE I
)
òòI J
;
òòJ K
else
ôô 
if
ôô 
(
ôô 
activeFilter
ôô %
==
ôô& (
$str
ôô) 3
)
ôô3 4

categories
öö 
=
öö  

categories
öö! +
.
öö+ ,
Where
öö, 1
(
öö1 2
x
öö2 3
=>
öö4 6
x
öö7 8
.
öö8 9
IsActive
öö9 A
==
ööB D
false
ööE J
)
ööJ K
;
ööK L
}
õõ 
if
úú 
(
úú 
!
úú 
String
úú 
.
úú 
IsNullOrEmpty
úú %
(
úú% &
	uomFilter
úú& /
)
úú/ 0
)
úú0 1

categories
ùù 
=
ùù 

categories
ùù '
.
ùù' (
Where
ùù( -
(
ùù- .
x
ùù. /
=>
ùù0 2
x
ùù3 4
.
ùù4 5
UOM
ùù5 8
==
ùù9 ;
	uomFilter
ùù< E
)
ùùE F
;
ùùF G
if
ûû 
(
ûû 
!
ûû 
String
ûû 
.
ûû 
IsNullOrEmpty
ûû %
(
ûû% &
ownerFilter
ûû& 1
)
ûû1 2
)
ûû2 3

categories
üü 
=
üü 

categories
üü '
.
üü' (
Where
üü( -
(
üü- .
x
üü. /
=>
üü0 2
x
üü3 4
.
üü4 5
ServiceOwner
üü5 A
!=
üüB D
null
üüE I
&&
üüJ L
x
üüM N
.
üüN O
ServiceOwner
üüO [
.
üü[ \
ToLower
üü\ c
(
üüc d
)
üüd e
.
üüe f
Contains
üüf n
(
üün o
ownerFilter
üüo z
.
üüz {
ToLowerüü{ Ç
(üüÇ É
)üüÉ Ñ
)üüÑ Ö
)üüÖ Ü
;üüÜ á
return
†† 

categories
†† 
;
†† 
}
°° 	
}
¢¢ 
}££ ‘
6C:\Repos\Service-Billing\Data\ServiceBillingContext.cs
	namespace		 	
Service_Billing		
 
.		 
Data		 
{

 
public 

class !
ServiceBillingContext &
:' (
	DbContext) 2
{ 
public !
ServiceBillingContext $
(% &
DbContextOptions& 6
<6 7!
ServiceBillingContext7 L
>L M
optionsN U
)U V
: 
base 
( 
options 
) 
{ 	
} 	
public 
DbSet 
< 
Bill 
> 
Bills  
{! "
get# &
;& '
set( +
;+ ,
}- .
=/ 0
default1 8
!8 9
;9 :
public 
DbSet 
< 
ClientAccount "
>" #
ClientAccounts$ 2
{3 4
get5 8
;8 9
set: =
;= >
}? @
public 
DbSet 
< 

ClientTeam 
>  
ClientTeams! ,
{- .
get/ 2
;2 3
set4 7
;7 8
}9 :
public 
DbSet 
< 
ServiceCategory $
>$ %
ServiceCategories& 7
{8 9
get: =
;= >
set? B
;B C
}D E
public 
DbSet 
< 
Service_Billing $
.$ %

ViewModels% /
./ 0!
ClientIntakeViewModel0 E
>E F!
ClientIntakeViewModelG \
{] ^
get_ b
;b c
setd g
;g h
}i j
=k l
defaultm t
!t u
;u v
public 
DbSet 
< 
Ministry 
> 

Ministries )
{* +
get, /
;/ 0
set1 4
;4 5
}6 7
} 
} Œ≤
=C:\Repos\Service-Billing\Migrations\20230907214549_initial.cs
	namespace 	
Service_Billing
 
. 

Migrations $
{ 
public		 

partial		 
class		 
initial		  
:		! "
	Migration		# ,
{

 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str 
, 
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
type+ /
:/ 0
$str1 6
,6 7
nullable8 @
:@ A
falseB G
)G H
. 

Annotation #
(# $
$str$ 8
,8 9
$str: @
)@ A
,A B
ClientAccountId #
=$ %
table& +
.+ ,
Column, 2
<2 3
int3 6
>6 7
(7 8
type8 <
:< =
$str> C
,C D
nullableE M
:M N
falseO T
)T U
,U V

ClientName 
=  
table! &
.& '
Column' -
<- .
string. 4
>4 5
(5 6
type6 :
:: ;
$str< K
,K L
nullableM U
:U V
trueW [
)[ \
,\ ]
Title 
= 
table !
.! "
Column" (
<( )
string) /
>/ 0
(0 1
type1 5
:5 6
$str7 F
,F G
nullableH P
:P Q
trueR V
)V W
,W X
	IdirOrUrl 
= 
table  %
.% &
Column& ,
<, -
string- 3
>3 4
(4 5
type5 9
:9 :
$str; J
,J K
nullableL T
:T U
trueV Z
)Z [
,[ \
ServiceCategoryId %
=& '
table( -
.- .
Column. 4
<4 5
int5 8
>8 9
(9 :
type: >
:> ?
$str@ E
,E F
nullableG O
:O P
trueQ U
)U V
,V W
Amount 
= 
table "
." #
Column# )
<) *
decimal* 1
>1 2
(2 3
type3 7
:7 8
$str9 H
,H I
nullableJ R
:R S
trueT X
)X Y
,Y Z
FiscalPeriod  
=! "
table# (
.( )
Column) /
</ 0
string0 6
>6 7
(7 8
type8 <
:< =
$str> M
,M N
nullableO W
:W X
trueY ]
)] ^
,^ _
Quantity 
= 
table $
.$ %
Column% +
<+ ,
decimal, 3
>3 4
(4 5
type5 9
:9 :
$str; J
,J K
nullableL T
:T U
trueV Z
)Z [
,[ \(
ticketNumberAndRequesterName 0
=1 2
table3 8
.8 9
Column9 ?
<? @
string@ F
>F G
(G H
typeH L
:L M
$strN ]
,] ^
nullable_ g
:g h
truei m
)m n
,n o
DateModified  
=! "
table# (
.( )
Column) /
</ 0
DateTime0 8
>8 9
(9 :
type: >
:> ?
$str@ K
,K L
nullableM U
:U V
trueW [
)[ \
,\ ]
DateCreated 
=  !
table" '
.' (
Column( .
<. /
DateTime/ 7
>7 8
(8 9
type9 =
:= >
$str? J
,J K
nullableL T
:T U
trueV Z
)Z [
,[ \
BillingCycle  
=! "
table# (
.( )
Column) /
</ 0
string0 6
>6 7
(7 8
type8 <
:< =
$str> M
,M N
nullableO W
:W X
trueY ]
)] ^
,^ _
	CreatedBy   
=   
table    %
.  % &
Column  & ,
<  , -
string  - 3
>  3 4
(  4 5
type  5 9
:  9 :
$str  ; J
,  J K
nullable  L T
:  T U
true  V Z
)  Z [
}!! 
,!! 
constraints"" 
:"" 
table"" "
=>""# %
{## 
table$$ 
.$$ 

PrimaryKey$$ $
($$$ %
$str$$% /
,$$/ 0
x$$1 2
=>$$3 5
x$$6 7
.$$7 8
Id$$8 :
)$$: ;
;$$; <
}%% 
)%% 
;%% 
migrationBuilder'' 
.'' 
CreateTable'' (
(''( )
name(( 
:(( 
$str(( &
,((& '
columns)) 
:)) 
table)) 
=>)) !
new))" %
{** 
Id++ 
=++ 
table++ 
.++ 
Column++ %
<++% &
int++& )
>++) *
(++* +
type+++ /
:++/ 0
$str++1 6
,++6 7
nullable++8 @
:++@ A
false++B G
)++G H
.,, 

Annotation,, #
(,,# $
$str,,$ 8
,,,8 9
$str,,: @
),,@ A
,,,A B
Name-- 
=-- 
table--  
.--  !
Column--! '
<--' (
string--( .
>--. /
(--/ 0
type--0 4
:--4 5
$str--6 E
,--E F
nullable--G O
:--O P
true--Q U
)--U V
,--V W
ClientNumber..  
=..! "
table..# (
...( )
Column..) /
<../ 0
short..0 5
>..5 6
(..6 7
type..7 ;
:..; <
$str..= G
,..G H
	maxLength..I R
:..R S
$num..T U
,..U V
nullable..W _
:.._ `
true..a e
)..e f
,..f g 
ResponsibilityCentre// (
=//) *
table//+ 0
.//0 1
Column//1 7
<//7 8
string//8 >
>//> ?
(//? @
type//@ D
://D E
$str//F S
,//S T
	maxLength//U ^
://^ _
$num//` a
,//a b
nullable//c k
://k l
true//m q
)//q r
,//r s
ServiceLine00 
=00  !
table00" '
.00' (
Column00( .
<00. /
int00/ 2
>002 3
(003 4
type004 8
:008 9
$str00: ?
,00? @
	maxLength00A J
:00J K
$num00L M
,00M N
nullable00O W
:00W X
true00Y ]
)00] ^
,00^ _
STOB11 
=11 
table11  
.11  !
Column11! '
<11' (
short11( -
>11- .
(11. /
type11/ 3
:113 4
$str115 ?
,11? @
	maxLength11A J
:11J K
$num11L M
,11M N
nullable11O W
:11W X
true11Y ]
)11] ^
,11^ _
Project22 
=22 
table22 #
.22# $
Column22$ *
<22* +
string22+ 1
>221 2
(222 3
type223 7
:227 8
$str229 F
,22F G
	maxLength22H Q
:22Q R
$num22S T
,22T U
nullable22V ^
:22^ _
true22` d
)22d e
,22e f 
ExpenseAuthorityName33 (
=33) *
table33+ 0
.330 1
Column331 7
<337 8
string338 >
>33> ?
(33? @
type33@ D
:33D E
$str33F U
,33U V
nullable33W _
:33_ `
true33a e
)33e f
,33f g
ServicesEnabled44 #
=44$ %
table44& +
.44+ ,
Column44, 2
<442 3
string443 9
>449 :
(44: ;
type44; ?
:44? @
$str44A P
,44P Q
nullable44R Z
:44Z [
true44\ `
)44` a
,44a b

ClientTeam55 
=55  
table55! &
.55& '
Column55' -
<55- .
string55. 4
>554 5
(555 6
type556 :
:55: ;
$str55< K
,55K L
nullable55M U
:55U V
true55W [
)55[ \
,55\ ]
TeamId66 
=66 
table66 "
.66" #
Column66# )
<66) *
int66* -
>66- .
(66. /
type66/ 3
:663 4
$str665 :
,66: ;
nullable66< D
:66D E
true66F J
)66J K
,66K L
IsApprovedByEA77 "
=77# $
table77% *
.77* +
Column77+ 1
<771 2
bool772 6
>776 7
(777 8
type778 <
:77< =
$str77> C
,77C D
nullable77E M
:77M N
false77O T
)77T U
}88 
,88 
constraints99 
:99 
table99 "
=>99# %
{:: 
table;; 
.;; 

PrimaryKey;; $
(;;$ %
$str;;% 8
,;;8 9
x;;: ;
=>;;< >
x;;? @
.;;@ A
Id;;A C
);;C D
;;;D E
}<< 
)<< 
;<< 
migrationBuilder>> 
.>> 
CreateTable>> (
(>>( )
name?? 
:?? 
$str?? #
,??# $
columns@@ 
:@@ 
table@@ 
=>@@ !
new@@" %
{AA 
IdBB 
=BB 
tableBB 
.BB 
ColumnBB %
<BB% &
intBB& )
>BB) *
(BB* +
typeBB+ /
:BB/ 0
$strBB1 6
,BB6 7
nullableBB8 @
:BB@ A
falseBBB G
)BBG H
.CC 

AnnotationCC #
(CC# $
$strCC$ 8
,CC8 9
$strCC: @
)CC@ A
,CCA B
NameDD 
=DD 
tableDD  
.DD  !
ColumnDD! '
<DD' (
stringDD( .
>DD. /
(DD/ 0
typeDD0 4
:DD4 5
$strDD6 E
,DDE F
nullableDDG O
:DDO P
trueDDQ U
)DDU V
,DDV W
PrimaryContactEE "
=EE# $
tableEE% *
.EE* +
ColumnEE+ 1
<EE1 2
stringEE2 8
>EE8 9
(EE9 :
typeEE: >
:EE> ?
$strEE@ O
,EEO P
nullableEEQ Y
:EEY Z
falseEE[ `
)EE` a
,EEa b
ApproverFF 
=FF 
tableFF $
.FF$ %
ColumnFF% +
<FF+ ,
stringFF, 2
>FF2 3
(FF3 4
typeFF4 8
:FF8 9
$strFF: I
,FFI J
nullableFFK S
:FFS T
falseFFU Z
)FFZ [
,FF[ \
FinancialContactGG $
=GG% &
tableGG' ,
.GG, -
ColumnGG- 3
<GG3 4
stringGG4 :
>GG: ;
(GG; <
typeGG< @
:GG@ A
$strGGB Q
,GGQ R
nullableGGS [
:GG[ \
falseGG] b
)GGb c
}HH 
,HH 
constraintsII 
:II 
tableII "
=>II# %
{JJ 
tableKK 
.KK 

PrimaryKeyKK $
(KK$ %
$strKK% 5
,KK5 6
xKK7 8
=>KK9 ;
xKK< =
.KK= >
IdKK> @
)KK@ A
;KKA B
}LL 
)LL 
;LL 
migrationBuilderNN 
.NN 
CreateTableNN (
(NN( )
nameOO 
:OO 
$strOO "
,OO" #
columnsPP 
:PP 
tablePP 
=>PP !
newPP" %
{QQ 
IdRR 
=RR 
tableRR 
.RR 
ColumnRR %
<RR% &
intRR& )
>RR) *
(RR* +
typeRR+ /
:RR/ 0
$strRR1 6
,RR6 7
nullableRR8 @
:RR@ A
falseRRB G
)RRG H
.SS 

AnnotationSS #
(SS# $
$strSS$ 8
,SS8 9
$strSS: @
)SS@ A
,SSA B
TitleTT 
=TT 
tableTT !
.TT! "
ColumnTT" (
<TT( )
stringTT) /
>TT/ 0
(TT0 1
typeTT1 5
:TT5 6
$strTT7 F
,TTF G
nullableTTH P
:TTP Q
trueTTR V
)TTV W
,TTW X
AcronymUU 
=UU 
tableUU #
.UU# $
ColumnUU$ *
<UU* +
stringUU+ 1
>UU1 2
(UU2 3
typeUU3 7
:UU7 8
$strUU9 H
,UUH I
nullableUUJ R
:UUR S
trueUUT X
)UUX Y
}VV 
,VV 
constraintsWW 
:WW 
tableWW "
=>WW# %
{XX 
tableYY 
.YY 

PrimaryKeyYY $
(YY$ %
$strYY% 4
,YY4 5
xYY6 7
=>YY8 :
xYY; <
.YY< =
IdYY= ?
)YY? @
;YY@ A
}ZZ 
)ZZ 
;ZZ 
migrationBuilder\\ 
.\\ 
CreateTable\\ (
(\\( )
name]] 
:]] 
$str]] )
,]]) *
columns^^ 
:^^ 
table^^ 
=>^^ !
new^^" %
{__ 
	ServiceId`` 
=`` 
table``  %
.``% &
Column``& ,
<``, -
int``- 0
>``0 1
(``1 2
type``2 6
:``6 7
$str``8 =
,``= >
nullable``? G
:``G H
false``I N
)``N O
.aa 

Annotationaa #
(aa# $
$straa$ 8
,aa8 9
$straa: @
)aa@ A
,aaA B

GDXBusAreabb 
=bb  
tablebb! &
.bb& '
Columnbb' -
<bb- .
stringbb. 4
>bb4 5
(bb5 6
typebb6 :
:bb: ;
$strbb< K
,bbK L
nullablebbM U
:bbU V
truebbW [
)bb[ \
,bb\ ]
Namecc 
=cc 
tablecc  
.cc  !
Columncc! '
<cc' (
stringcc( .
>cc. /
(cc/ 0
typecc0 4
:cc4 5
$strcc6 E
,ccE F
nullableccG O
:ccO P
trueccQ U
)ccU V
,ccV W
Costsdd 
=dd 
tabledd !
.dd! "
Columndd" (
<dd( )
stringdd) /
>dd/ 0
(dd0 1
typedd1 5
:dd5 6
$strdd7 F
,ddF G
nullableddH P
:ddP Q
trueddR V
)ddV W
,ddW X
Descriptionee 
=ee  !
tableee" '
.ee' (
Columnee( .
<ee. /
stringee/ 5
>ee5 6
(ee6 7
typeee7 ;
:ee; <
$stree= L
,eeL M
nullableeeN V
:eeV W
trueeeX \
)ee\ ]
,ee] ^
IsActiveff 
=ff 
tableff $
.ff$ %
Columnff% +
<ff+ ,
boolff, 0
>ff0 1
(ff1 2
typeff2 6
:ff6 7
$strff8 =
,ff= >
nullableff? G
:ffG H
falseffI N
)ffN O
,ffO P
UOMgg 
=gg 
tablegg 
.gg  
Columngg  &
<gg& '
stringgg' -
>gg- .
(gg. /
typegg/ 3
:gg3 4
$strgg5 D
,ggD E
nullableggF N
:ggN O
trueggP T
)ggT U
,ggU V
ServiceOwnerhh  
=hh! "
tablehh# (
.hh( )
Columnhh) /
<hh/ 0
stringhh0 6
>hh6 7
(hh7 8
typehh8 <
:hh< =
$strhh> M
,hhM N
nullablehhO W
:hhW X
truehhY ]
)hh] ^
}ii 
,ii 
constraintsjj 
:jj 
tablejj "
=>jj# %
{kk 
tablell 
.ll 

PrimaryKeyll $
(ll$ %
$strll% ;
,ll; <
xll= >
=>ll? A
xllB C
.llC D
	ServiceIdllD M
)llM N
;llN O
}mm 
)mm 
;mm 
migrationBuilderoo 
.oo 
CreateTableoo (
(oo( )
namepp 
:pp 
$strpp -
,pp- .
columnsqq 
:qq 
tableqq 
=>qq !
newqq" %
{rr 
Idss 
=ss 
tabless 
.ss 
Columnss %
<ss% &
intss& )
>ss) *
(ss* +
typess+ /
:ss/ 0
$strss1 6
,ss6 7
nullabless8 @
:ss@ A
falsessB G
)ssG H
.tt 

Annotationtt #
(tt# $
$strtt$ 8
,tt8 9
$strtt: @
)tt@ A
,ttA B
TeamIduu 
=uu 
tableuu "
.uu" #
Columnuu# )
<uu) *
intuu* -
>uu- .
(uu. /
typeuu/ 3
:uu3 4
$struu5 :
,uu: ;
nullableuu< D
:uuD E
trueuuF J
)uuJ K
,uuK L
	AccountIdvv 
=vv 
tablevv  %
.vv% &
Columnvv& ,
<vv, -
intvv- 0
>vv0 1
(vv1 2
typevv2 6
:vv6 7
$strvv8 =
,vv= >
nullablevv? G
:vvG H
falsevvI N
)vvN O
,vvO P
MinistryAcronymww #
=ww$ %
tableww& +
.ww+ ,
Columnww, 2
<ww2 3
stringww3 9
>ww9 :
(ww: ;
typeww; ?
:ww? @
$strwwA P
,wwP Q
nullablewwR Z
:wwZ [
trueww\ `
)ww` a
,wwa b
DivisionOrBranchxx $
=xx% &
tablexx' ,
.xx, -
Columnxx- 3
<xx3 4
stringxx4 :
>xx: ;
(xx; <
typexx< @
:xx@ A
$strxxB Q
,xxQ R
nullablexxS [
:xx[ \
truexx] a
)xxa b
}yy 
,yy 
constraintszz 
:zz 
tablezz "
=>zz# %
{{{ 
table|| 
.|| 

PrimaryKey|| $
(||$ %
$str||% ?
,||? @
x||A B
=>||C E
x||F G
.||G H
Id||H J
)||J K
;||K L
table}} 
.}} 

ForeignKey}} $
(}}$ %
name~~ 
:~~ 
$str~~ Q
,~~Q R
column 
: 
x  !
=>" $
x% &
.& '
	AccountId' 0
,0 1
principalTable
ÄÄ &
:
ÄÄ& '
$str
ÄÄ( 8
,
ÄÄ8 9
principalColumn
ÅÅ '
:
ÅÅ' (
$str
ÅÅ) -
,
ÅÅ- .
onDelete
ÇÇ  
:
ÇÇ  !
ReferentialAction
ÇÇ" 3
.
ÇÇ3 4
Cascade
ÇÇ4 ;
)
ÇÇ; <
;
ÇÇ< =
table
ÉÉ 
.
ÉÉ 

ForeignKey
ÉÉ $
(
ÉÉ$ %
name
ÑÑ 
:
ÑÑ 
$str
ÑÑ K
,
ÑÑK L
column
ÖÖ 
:
ÖÖ 
x
ÖÖ  !
=>
ÖÖ" $
x
ÖÖ% &
.
ÖÖ& '
TeamId
ÖÖ' -
,
ÖÖ- .
principalTable
ÜÜ &
:
ÜÜ& '
$str
ÜÜ( 5
,
ÜÜ5 6
principalColumn
áá '
:
áá' (
$str
áá) -
)
áá- .
;
áá. /
}
àà 
)
àà 
;
àà 
migrationBuilder
ää 
.
ää 
CreateIndex
ää (
(
ää( )
name
ãã 
:
ãã 
$str
ãã :
,
ãã: ;
table
åå 
:
åå 
$str
åå .
,
åå. /
column
çç 
:
çç 
$str
çç #
)
çç# $
;
çç$ %
migrationBuilder
èè 
.
èè 
CreateIndex
èè (
(
èè( )
name
êê 
:
êê 
$str
êê 7
,
êê7 8
table
ëë 
:
ëë 
$str
ëë .
,
ëë. /
column
íí 
:
íí 
$str
íí  
)
íí  !
;
íí! "
}
ìì 	
	protected
ññ 
override
ññ 
void
ññ 
Down
ññ  $
(
ññ$ %
MigrationBuilder
ññ% 5
migrationBuilder
ññ6 F
)
ññF G
{
óó 	
migrationBuilder
òò 
.
òò 
	DropTable
òò &
(
òò& '
name
ôô 
:
ôô 
$str
ôô 
)
ôô 
;
ôô 
migrationBuilder
õõ 
.
õõ 
	DropTable
õõ &
(
õõ& '
name
úú 
:
úú 
$str
úú -
)
úú- .
;
úú. /
migrationBuilder
ûû 
.
ûû 
	DropTable
ûû &
(
ûû& '
name
üü 
:
üü 
$str
üü "
)
üü" #
;
üü# $
migrationBuilder
°° 
.
°° 
	DropTable
°° &
(
°°& '
name
¢¢ 
:
¢¢ 
$str
¢¢ )
)
¢¢) *
;
¢¢* +
migrationBuilder
§§ 
.
§§ 
	DropTable
§§ &
(
§§& '
name
•• 
:
•• 
$str
•• &
)
••& '
;
••' (
migrationBuilder
ßß 
.
ßß 
	DropTable
ßß &
(
ßß& '
name
®® 
:
®® 
$str
®® #
)
®®# $
;
®®$ %
}
©© 	
}
™™ 
}´´ “
'C:\Repos\Service-Billing\Models\Bill.cs
	namespace 	
Service_Billing
 
. 
Models  
{ 
public 

class 
Bill 
{ 
[ 	
Key	 
] 
public		 
int		 
Id		 
{		 
get		 
;		 
set		  
;		  !
}		" #
public

 
int

 
ClientAccountId

 "
{

# $
get

% (
;

( )
set

* -
;

- .
}

/ 0
[ 	
Display	 
( 
Name 
= 
$str %
)% &
]& '
public 
string 
? 

ClientName !
{" #
get$ '
;' (
set) ,
;, -
}. /
[ 	
Display	 
( 
Name 
= 
$str 
)  
]  !
public 
string 
? 
Title 
{ 
get "
;" #
set$ '
;' (
}) *
[ 	
Display	 
( 
Name 
= 
$str %
)% &
]& '
public 
string 
? 
	IdirOrUrl  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
int 
? 
ServiceCategoryId %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
[ 	
Display	 
( 
Name 
= 
$str  
)  !
]! "
public 
decimal 
? 
Amount 
{  
get! $
;$ %
set& )
;) *
}+ ,
[ 	
Display	 
( 
Name 
= 
$str '
)' (
]( )
public 
string 
? 
FiscalPeriod #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
decimal 
? 
Quantity  
{! "
get# &
;& '
set( +
;+ ,
}- .
[ 	
Column	 
( 
$str .
). /
]/ 0
[   	
Display  	 
(   
Name   
=   
$str   '
)  ' (
]  ( )
public!! 
string!! 
?!! $
TicketNumberAndRequester!! /
{!!0 1
get!!2 5
;!!5 6
set!!7 :
;!!: ;
}!!< =
public## 
DateTime## 
?## 
DateModified## %
{##& '
get##( +
;##+ ,
set##- 0
;##0 1
}##2 3
public$$ 
DateTime$$ 
?$$ 
DateCreated$$ $
{$$% &
get$$' *
;$$* +
set$$, /
;$$/ 0
}$$1 2
public%% 
string%% 
?%% 
BillingCycle%% #
{%%$ %
get%%& )
;%%) *
set%%+ .
;%%. /
}%%0 1
public&& 
string&& 
?&& 
	CreatedBy&&  
{&&! "
get&&# &
;&&& '
set&&( +
;&&+ ,
}&&- .
public(( 
Bill(( 
((( 
)(( 
{)) 	
this** 
.** 
Quantity** 
=** 
$num** 
;** 
this++ 
.++ 
ServiceCategoryId++ "
=++# $
-++% &
$num++& '
;++' (
this,, 
.,, 
DateCreated,, 
=,, 
DateTime,, '
.,,' (
UtcNow,,( .
;,,. /
}-- 	
}.. 
}// µ&
0C:\Repos\Service-Billing\Models\ClientAccount.cs
	namespace 	
Service_Billing
 
. 
Models  
{ 
public		 

class		 
ClientAccount		 
{

 
[ 	
Key	 
] 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
[ 	
Display	 
( 
Name 
= 
$str 
) 
]  
public 
string 
? 
Name 
{ 
get !
;! "
set# &
;& '
}( )
[ 	
BindRequired	 
] 
[ 	
Display	 
( 
Name 
= 
$str '
)' (
]( )
public 
Int16 
? 
ClientNumber "
{# $
get% (
;( )
set* -
;- .
}/ 0
[ 	
BindRequired	 
] 
[ 	
StringLength	 
( 
$num 
) 
] 
[ 	
	MinLength	 
( 
$num 
) 
] 
[ 	
	MaxLength	 
( 
$num 
) 
] 
[ 	
Display	 
( 
Name 
= 
$str /
)/ 0
]0 1
public 
string 
?  
ResponsibilityCentre +
{, -
get. 1
;1 2
set3 6
;6 7
}8 9
[!! 	
BindRequired!!	 
]!! 
["" 	
Display""	 
("" 
Name"" 
="" 
$str"" &
)""& '
]""' (
[## 	
Range##	 
(## 
$num## 
,## 
$num## 
)## 
]## 
public$$ 
int$$ 
?$$ 
ServiceLine$$ 
{$$  !
get$$" %
;$$% &
set$$' *
;$$* +
}$$, -
[&& 	
BindRequired&&	 
]&& 
['' 	
Range''	 
('' 
$num'' 
,'' 
$num'' 
)'' 
]'' 
public(( 
Int16(( 
?(( 
STOB(( 
{(( 
get((  
;((  !
set((" %
;((% &
}((' (
[** 	
BindRequired**	 
]** 
[++ 	
StringLength++	 
(++ 
$num++ 
)++ 
]++ 
[,, 	
	MinLength,,	 
(,, 
$num,, 
),, 
],, 
[-- 	
Display--	 
(-- 
Name-- 
=-- 
$str-- !
)--! "
]--" #
public.. 
string.. 
?.. 
Project.. 
{..  
get..! $
;..$ %
set..& )
;..) *
}..+ ,
[11 	
BindRequired11	 
]11 
[22 	
Display22	 
(22 
Name22 
=22 
$str22 +
)22+ ,
]22, -
public33 
string33 
?33  
ExpenseAuthorityName33 +
{33, -
get33. 1
;331 2
set333 6
;336 7
}338 9
[55 	
Display55	 
(55 
Name55 
=55 
$str55 *
)55* +
]55+ ,
public66 
string66 
?66 
ServicesEnabled66 &
{66' (
get66) ,
;66, -
set66. 1
;661 2
}663 4
[88 	
Display88	 
(88 
Name88 
=88 
$str88 %
)88% &
]88& '
public99 
string99 
?99 

ClientTeam99 !
{99" #
get99$ '
;99' (
set99) ,
;99, -
}99. /
public>> 
int>> 
?>> 
TeamId>> 
{>> 
get>>  
;>>  !
set>>" %
;>>% &
}>>' (
public@@ 
bool@@ 
IsApprovedByEA@@ "
{@@# $
get@@% (
;@@( )
set@@* -
;@@- .
}@@/ 0
=@@1 2
false@@3 8
;@@8 9
[BB 	
BindRequiredBB	 
]BB 
[DD 	
DisplayDD	 
(DD 
NameDD 
=DD 
$strDD +
)DD+ ,
]DD, -
publicEE 
intEE 
?EE 
CasClientNumberEE #
{EE$ %
getEE& )
;EE) *
setEE+ .
;EE. /
}EE0 1
}FF 
}GG ¶
-C:\Repos\Service-Billing\Models\ClientTeam.cs
	namespace 	
Service_Billing
 
. 
Models  
{ 
public 

class 

ClientTeam 
{ 
[ 	
Key	 
] 
public		 
int		 
Id		 
{		 
get		 
;		 
set		  
;		  !
}		" #
[ 	
Display	 
( 
Name 
= 
$str "
)" #
]# $
public 
string 
? 
Name 
{ 
get !
;! "
set# &
;& '
}( )
[ 	
Required	 
( 
ErrorMessage 
=  
$str! >
)> ?
]? @
[ 	
Display	 
( 
Name 
= 
$str )
)) *
]* +
public 
string 
? 
PrimaryContact %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
[ 	
Required	 
( 
ErrorMessage 
=  
$str! >
)> ?
]? @
public 
string 
? 
Approver 
{  !
get" %
;% &
set' *
;* +
}, -
[   	
Required  	 
(   
ErrorMessage   
=    
$str  ! >
)  > ?
]  ? @
[!! 	
Display!!	 
(!! 
Name!! 
=!! 
$str!! +
)!!+ ,
]!!, -
public"" 
string"" 
?"" 
FinancialContact"" '
{""( )
get""* -
;""- .
set""/ 2
;""2 3
}""4 5
}(( 
})) Ä
1C:\Repos\Service-Billing\Models\ErrorViewModel.cs
	namespace 	
Service_Billing
 
. 
Models  
;  !
public 
class 
ErrorViewModel 
{ 
public 

string 
? 
	RequestId 
{ 
get "
;" #
set$ '
;' (
}) *
public 

bool 
ShowRequestId 
=>  
!! "
string" (
.( )
IsNullOrEmpty) 6
(6 7
	RequestId7 @
)@ A
;A B
} ‹
+C:\Repos\Service-Billing\Models\Ministry.cs
	namespace 	
Service_Billing
 
. 
Models  
{ 
public 

class 
Ministry 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
string 
? 
Title 
{ 
get "
;" #
set$ '
;' (
}) *
public 
string 
? 
Acronym 
{  
get! $
;$ %
set& )
;) *
}+ ,
} 
}		 ∫Y
>C:\Repos\Service-Billing\Models\Repositories\BillRepository.cs
	namespace 	
Service_Billing
 
. 
Models  
.  !
Repositories! -
{ 
public		 

class		 
BillRepository		 
:		  !
IBillRepositroy		" 1
{

 
private 
readonly !
ServiceBillingContext .
_billingContext/ >
;> ?
public 
BillRepository 
(  !
ServiceBillingContext  5
billingContext6 D
)D E
{ 	
_billingContext 
= 
billingContext ,
;, -
} 	
public 
IEnumerable 
< 
Bill 
>  
AllBills! )
=>* ,
_billingContext- <
.< =
Bills= B
.B C
OrderByC J
(J K
bK L
=>M O
bP Q
.Q R
TitleR W
)W X
;X Y
public 
string #
DetermineCurrentQuarter -
(- .
DateTime. 6
?6 7
date8 <
== >
null? C
)C D
{ 	
DateTime 
today 
= 
DateTime %
.% &
Today& +
;+ ,
if 
( 
date 
!= 
null 
) 
today 
= 
date 
. 
Value "
;" #
string 
quarter 
= 
$str 
;  
string 
year1 
= 
today  
.  !
Year! %
.% &
ToString& .
(. /
)/ 0
;0 1
string 
year2 
= 
( 
today !
.! "
Year" &
+' (
$num) *
)* +
.+ ,
ToString, 4
(4 5
)5 6
;6 7
switch 
( 
today 
. 
Month 
)  
{ 
case 
$num 
: 
case 
$num 
: 
case   
$num   
:   
quarter!! 
=!! 
$str!! )
;!!) *
break"" 
;"" 
case## 
$num## 
:## 
case$$ 
$num$$ 
:$$ 
case%% 
$num%% 
:%% 
quarter&& 
=&& 
$str&& )
;&&) *
break'' 
;'' 
case(( 
$num(( 
:(( 
case)) 
$num)) 
:)) 
case** 
$num** 
:** 
quarter++ 
=++ 
$str++ )
;++) *
break,, 
;,, 
case-- 
$num-- 
:-- 
case.. 
$num.. 
:.. 
case// 
$num// 
:// 
quarter00 
=00 
$str00 )
;00) *
break11 
;11 
}22 
return44 
$"44 
$str44 
{44 
year144 "
.44" #
	Substring44# ,
(44, -
$num44- .
)44. /
}44/ 0
$str440 1
{441 2
year2442 7
.447 8
	Substring448 A
(44A B
$num44B C
)44C D
}44D E
$str44E F
{44F G
quarter44G N
}44N O
"44O P
;44P Q
}55 	
public77 
IEnumerable77 
<77 
Bill77 
>77  "
GetCurrentQuarterBills77! 7
(777 8
)778 9
{88 	
string99 
fiscalPeriod99 
=99  !#
DetermineCurrentQuarter99" 9
(999 :
)99: ;
;99; <
return:: 
_billingContext:: "
.::" #
Bills::# (
.::( )
Where::) .
(::. /
b::/ 0
=>::1 3
b::4 5
.::5 6
FiscalPeriod::6 B
==::C E
fiscalPeriod::F R
)::R S
;::S T
};; 	
public== 
IEnumerable== 
<== 
Bill== 
>==  #
GetPreviousQuarterBills==! 8
(==8 9
)==9 :
{>> 	
try?? 
{@@ 
stringAA 
currentFiscalPeriodAA *
=AA+ ,#
DetermineCurrentQuarterAA- D
(AAD E
)AAE F
;AAF G
ifCC 
(CC 
currentFiscalPeriodCC '
.CC' (
ContainsCC( 0
(CC0 1
$strCC1 <
)CC< =
)CC= >
{DD 
intEE 
yearEE 
;EE 
varFF 
xFF 
=FF 
currentFiscalPeriodFF /
.FF/ 0
	SubstringFF0 9
(FF9 :
$numFF: <
,FF< =
$numFF> ?
)FF? @
;FF@ A
ifGG 
(GG 
!GG 
intGG 
.GG 
TryParseGG %
(GG% &
currentFiscalPeriodGG& 9
.GG9 :
	SubstringGG: C
(GGC D
$numGGD F
,GGF G
$numGGH I
)GGI J
,GGJ K
nullGGL P
,GGP Q
outGGR U
yearGGV Z
)GGZ [
)GG[ \
{HH 
throwII 
newII !
	ExceptionII" +
(II+ ,
$strII, \
)II\ ]
;II] ^
}JJ 
returnKK 
_billingContextKK *
.KK* +
BillsKK+ 0
.KK0 1
WhereKK1 6
(KK6 7
bKK7 8
=>KK9 ;
bKK< =
.KK= >
FiscalPeriodKK> J
==KKK M
$"KKN P
$strKKP W
{KKW X
yearKKX \
-KK] ^
$numKK_ `
}KK` a
$strKKa b
{KKb c
yearKKc g
-KKh i
$numKKi j
}KKj k
$strKKk u
"KKu v
)KKv w
;KKw x
}LL 
elseMM 
{NN 
intOO 
quarterOO 
;OO  
ifPP 
(PP 
!PP 
intPP 
.PP 
TryParsePP %
(PP% &
currentFiscalPeriodPP& 9
.PP9 :
LastPP: >
(PP> ?
)PP? @
.PP@ A
ToStringPPA I
(PPI J
)PPJ K
,PPK L
nullPPM Q
,PPQ R
outPPS V
quarterPPW ^
)PP^ _
)PP_ `
{QQ 
throwRR 
newRR !
	ExceptionRR" +
(RR+ ,
$strRR, _
)RR_ `
;RR` a
}SS 
currentFiscalPeriodTT '
=TT( )
currentFiscalPeriodTT* =
.TT= >
RemoveTT> D
(TTD E
currentFiscalPeriodTTE X
.TTX Y
LengthTTY _
-TT` a
$numTTb c
)TTc d
;TTd e
currentFiscalPeriodUU '
+=UU( *
(UU+ ,
quarterUU, 3
-UU4 5
$numUU6 7
)UU7 8
;UU8 9
returnVV 
_billingContextVV *
.VV* +
BillsVV+ 0
.VV0 1
WhereVV1 6
(VV6 7
bVV7 8
=>VV9 ;
bVV< =
.VV= >
FiscalPeriodVV> J
==VVK M
currentFiscalPeriodVVN a
)VVa b
;VVb c
}WW 
}XX 
catchYY 
(YY 
	ExceptionYY 
eYY 
)YY 
{ZZ 
}\\ 
return^^ 
null^^ 
;^^ 
}__ 	
publicaa 
Billaa 
?aa 
GetBillaa 
(aa 
intaa  
idaa! #
)aa# $
{bb 	
returncc 
_billingContextcc "
.cc" #
Billscc# (
.cc( )
FirstOrDefaultcc) 7
(cc7 8
bcc8 9
=>cc: <
bcc= >
.cc> ?
Idcc? A
==ccB D
idccE G
)ccG H
;ccH I
}dd 	
publicff 
IEnumerableff 
<ff 
Billff 
>ff  
SearchBillsByTitleff! 3
(ff3 4
stringff4 :
searchQueryff; F
)ffF G
{gg 	
returnhh 
_billingContexthh "
.hh" #
Billshh# (
.hh( )
Wherehh) .
(hh. /
bhh/ 0
=>hh1 3
!hh4 5
stringhh5 ;
.hh; <
IsNullOrEmptyhh< I
(hhI J
bhhJ K
.hhK L
TitlehhL Q
)hhQ R
&&hhS U
bhhV W
.hhW X
TitlehhX ]
.hh] ^
Containshh^ f
(hhf g
searchQueryhhg r
)hhr s
)hhs t
;hht u
}ii 	
IEnumerablekk 
<kk 
Billkk 
>kk 
IBillRepositroykk )
.kk) *
GetBillsByAuthoritykk* =
(kk= >
stringkk> D
expenseAuthoritykkE U
)kkU V
{ll 	
throwmm 
newmm #
NotImplementedExceptionmm -
(mm- .
)mm. /
;mm/ 0
}nn 	
IEnumerablepp 
<pp 
Billpp 
>pp 
IBillRepositroypp )
.pp) *"
GetBillsByBillingCyclepp* @
(pp@ A
DateOnlyppA I
billingCycleppJ V
)ppV W
{qq 	
throwrr 
newrr #
NotImplementedExceptionrr -
(rr- .
)rr. /
;rr/ 0
}ss 	
IEnumerableuu 
<uu 
Billuu 
>uu 
IBillRepositroyuu )
.uu) *
GetBillsByClientIduu* <
(uu< =
intuu= @
clientIduuA I
)uuI J
{vv 	
throwww 
newww #
NotImplementedExceptionww -
(ww- .
)ww. /
;ww/ 0
}xx 	
IEnumerablezz 
<zz 
Billzz 
>zz 
IBillRepositroyzz )
.zz) *
GetBillsByDateRangezz* =
(zz= >
DateTimezz> F
startzzG L
,zzL M
DateTimezzN V
endzzW Z
)zzZ [
{{{ 	
throw|| 
new|| #
NotImplementedException|| -
(||- .
)||. /
;||/ 0
}}} 	
IEnumerable 
< 
Bill 
> 
IBillRepositroy )
.) *%
GetBillsByServiceCategory* C
(C D
intD G
serviceCategoryIdH Y
)Y Z
{
ÄÄ 	
throw
ÅÅ 
new
ÅÅ %
NotImplementedException
ÅÅ -
(
ÅÅ- .
)
ÅÅ. /
;
ÅÅ/ 0
}
ÇÇ 	
public
ÑÑ 
async
ÑÑ 
Task
ÑÑ 

CreateBill
ÑÑ $
(
ÑÑ$ %
Bill
ÑÑ% )
bill
ÑÑ* .
)
ÑÑ. /
{
ÖÖ 	
await
ÜÜ 
_billingContext
ÜÜ !
.
ÜÜ! "
AddAsync
ÜÜ" *
(
ÜÜ* +
bill
ÜÜ+ /
)
ÜÜ/ 0
;
ÜÜ0 1
await
áá 
_billingContext
áá !
.
áá! "
SaveChangesAsync
áá" 2
(
áá2 3
)
áá3 4
;
áá4 5
}
àà 	
}
ää 
}ãã ∆.
FC:\Repos\Service-Billing\Models\Repositories\ClientAccountRepositry.cs
	namespace 	
Service_Billing
 
. 
Models  
.  !
Repositories! -
{ 
public 

class "
ClientAccountRepositry '
:( )$
IClientAccountRepository* B
{ 
private		 
readonly		 !
ServiceBillingContext		 .
_context		/ 7
;		7 8
public

 "
ClientAccountRepositry

 %
(

% &!
ServiceBillingContext

& ;
context

< C
)

C D
{ 	
_context 
= 
context 
; 
} 	
public 
IEnumerable 
< 
ClientAccount (
>( )
GetAll* 0
(0 1
)1 2
{ 	
return 
_context 
. 
ClientAccounts *
.* +
OrderBy+ 2
(2 3
c3 4
=>5 7
c8 9
.9 :
Name: >
)> ?
;? @
} 	
public 
ClientAccount 
? 
GetClientAccount .
(. /
int/ 2
	accountId3 <
)< =
{ 	
return 
_context 
. 
ClientAccounts *
.* +
FirstOrDefault+ 9
(9 :
c: ;
=>< >
c? @
.@ A
IdA C
==D F
	accountIdG P
)P Q
;Q R
} 	
public 
IEnumerable 
< 
ClientAccount (
>( ) 
SearchClientAccounts* >
(> ?
string? E
queryStringF Q
)Q R
{ 	
return 
_context 
. 
ClientAccounts *
.* +
Where+ 0
(0 1
c1 2
=>3 5
c6 7
.7 8
Name8 <
.< =
Contains= E
(E F
queryStringF Q
)Q R
)R S
.S T
OrderByT [
([ \
c\ ]
=>^ `
ca b
.b c
Namec g
)g h
;h i
} 	
public 
int 
AddClientAccount #
(# $
ClientAccount$ 1
account2 9
)9 :
{ 	
_context   
.   
AddAsync   
(   
account   %
)  % &
;  & '
_context!! 
.!! 
SaveChanges!!  
(!!  !
)!!! "
;!!" #
return## 
account## 
.## 
Id## 
;## 
}$$ 	
public&& 
int&& '
GetClientIdFromClientNumber&& .
(&&. /
int&&/ 2
clientNumber&&3 ?
)&&? @
{'' 	
ClientAccount(( 
account(( !
=((" #
_context(($ ,
.((, -
ClientAccounts((- ;
.((; <
FirstOrDefault((< J
(((J K
x((K L
=>((M O
x((P Q
.((Q R
ClientNumber((R ^
==((_ a
clientNumber((b n
)((n o
;((o p
if)) 
()) 
account)) 
!=)) 
null)) 
)))  
return** 
account** 
.** 
Id** !
;**! "
else++ 
return++ 
$num++ 
;++ 
},, 	
public.. 
IEnumerable.. 
<.. 
ClientAccount.. (
>..( )$
GetAccountsByContactName..* B
(..B C
string..C I
contactName..J U
)..U V
{// 	
List00 
<00 

ClientTeam00 
>00 
	userTeams00 &
=00' (
_context00) 1
.001 2
ClientTeams002 =
.00= >
Where00> C
(00C D
x00D E
=>00F H
x00I J
.00J K
PrimaryContact00K Y
==00Z \
contactName00] h
)00h i
.00i j
ToList00j p
(00p q
)00q r
;00r s
	userTeams11 
.11 
AddRange11 
(11 
_context11 '
.11' (
ClientTeams11( 3
.113 4
Where114 9
(119 :
x11: ;
=>11< >
x11? @
.11@ A
FinancialContact11A Q
==11R T
contactName11U `
)11` a
)11a b
;11b c
	userTeams22 
.22 
AddRange22 
(22 
_context22 '
.22' (
ClientTeams22( 3
.223 4
Where224 9
(229 :
x22: ;
=>22< >
x22? @
.22@ A
Approver22A I
==22J L
contactName22M X
)22X Y
)22Y Z
;22Z [
List33 
<33 
ClientAccount33 
>33 
accounts33  (
=33) *
new33+ .
List33/ 3
<333 4
ClientAccount334 A
>33A B
(33B C
)33C D
;33D E
foreach55 
(55 

ClientTeam55 
team55 #
in55$ &
	userTeams55' 0
)550 1
{66 
accounts77 
.77 
AddRange77 !
(77! "
GetAll77" (
(77( )
)77) *
.77* +
Where77+ 0
(770 1
x771 2
=>773 5
x776 7
.777 8
TeamId778 >
==77? A
team77B F
.77F G
Id77G I
)77I J
)77J K
;77K L
}88 
return:: 
accounts:: 
.:: 
Distinct:: $
(::$ %
)::% &
;::& '
};; 	
}>> 
}?? Ë
DC:\Repos\Service-Billing\Models\Repositories\ClientTeamRepository.cs
	namespace 	
Service_Billing
 
. 
Models  
.  !
Repositories! -
{ 
public 

class  
ClientTeamRepository %
:& '!
IClientTeamRepository( =
{ 
private		 
readonly		 !
ServiceBillingContext		 .
_billingContext		/ >
;		> ?
public

  
ClientTeamRepository

 #
(

# $!
ServiceBillingContext

$ 9
billingContext

: H
)

H I
{ 	
_billingContext 
= 
billingContext ,
;, -
} 	
public 
IEnumerable 
< 

ClientTeam %
>% &
AllTeams' /
=>0 2
_billingContext3 B
.B C
ClientTeamsC N
.N O
OrderByO V
(V W
bW X
=>Y [
b\ ]
.] ^
Name^ b
)b c
;c d
public 

ClientTeam 
? 
GetTeamById &
(& '
int' *
?* +
id, .
). /
{ 	
if 
( 
id 
== 
null 
) 
return "
null# '
;' (
return 
_billingContext "
." #
ClientTeams# .
.. /
FirstOrDefault/ =
(= >
t> ?
=>@ B
tC D
.D E
IdE G
==H J
idK M
)M N
;N O
} 	
public 

ClientTeam 
? 
GetTeamByName (
(( )
string) /
name0 4
)4 5
{ 	
return 
_billingContext "
." #
ClientTeams# .
.. /
FirstOrDefault/ =
(= >
t> ?
=>@ B
tC D
.D E
NameE I
==J L
nameM Q
)Q R
;R S
} 	
public 
IEnumerable 
< 

ClientTeam %
>% &&
GetTeamsByFinancialContact' A
(A B
stringB H
contactI P
)P Q
{ 	
throw 
new #
NotImplementedException -
(- .
). /
;/ 0
} 	
public   
IEnumerable   
<   

ClientTeam   %
>  % &$
GetTeamsByPrimaryContact  ' ?
(  ? @
string  @ F
primaryContact  G U
)  U V
{!! 	
throw"" 
new"" #
NotImplementedException"" -
(""- .
)"". /
;""/ 0
}## 	
public%% 
int%% 
Add%% 
(%% 

ClientTeam%% !
team%%" &
)%%& '
{&& 	
_billingContext'' 
.'' 
AddAsync'' $
(''$ %
team''% )
)'') *
;''* +
_billingContext(( 
.(( 
SaveChanges(( '
(((' (
)((( )
;(() *
return** 
team** 
.** 
Id** 
;** 
}++ 	
},, 
}-- Ê
?C:\Repos\Service-Billing\Models\Repositories\IBillRepository.cs
	namespace 	
Service_Billing
 
. 
Models  
.  !
Repositories! -
{ 
public 

	interface 
IBillRepositroy $
{ 
IEnumerable 
< 
Bill 
> 
AllBills "
{# $
get% (
;( )
}* +
Bill 
? 
GetBill 
( 
int 
id 
) 
; 
IEnumerable		 
<		 
Bill		 
>		 
SearchBillsByTitle		 ,
(		, -
string		- 3
searchQuery		4 ?
)		? @
;		@ A
IEnumerable

 
<

 
Bill

 
>

 
GetBillsByClientId

 ,
(

, -
int

- 0
clientId

2 :
)

: ;
;

; <
IEnumerable 
< 
Bill 
> %
GetBillsByServiceCategory 3
(3 4
int4 7
serviceCategoryId8 I
)I J
;J K
IEnumerable 
< 
Bill 
> 
GetBillsByAuthority -
(- .
string. 4
expenseAuthority5 E
)E F
;F G
IEnumerable 
< 
Bill 
> "
GetBillsByBillingCycle 0
(0 1
DateOnly1 9
billingCycle: F
)F G
;G H
IEnumerable 
< 
Bill 
> 
GetBillsByDateRange -
(- .
DateTime. 6
start7 <
,< =
DateTime> F
endG J
)J K
;K L
IEnumerable 
< 
Bill 
> "
GetCurrentQuarterBills 0
(0 1
)1 2
;2 3
IEnumerable 
< 
Bill 
> #
GetPreviousQuarterBills 1
(1 2
)2 3
;3 4
Task 

CreateBill 
( 
Bill 
bill !
)! "
;" #
} 
} ø

HC:\Repos\Service-Billing\Models\Repositories\IClientAccountRepository.cs
	namespace 	
Service_Billing
 
. 
Models  
.  !
Repositories! -
{ 
public 

	interface $
IClientAccountRepository -
{ 
IEnumerable 
< 
ClientAccount !
>! "
GetAll# )
() *
)* +
;+ ,
ClientAccount 
? 
GetClientAccount '
(' (
int( +
	accountId, 5
)5 6
;6 7
IEnumerable 
< 
ClientAccount !
>! " 
SearchClientAccounts# 7
(7 8
string8 >
queryString? J
)J K
;K L
int 
AddClientAccount 
( 
ClientAccount *
account+ 2
)2 3
;3 4
int		 '
GetClientIdFromClientNumber		 '
(		' (
int		( +
clientNumber		, 8
)		8 9
;		9 :
IEnumerable

 
<

 
ClientAccount

 !
>

! "$
GetAccountsByContactName

# ;
(

; <
string

< B
contactName

C N
)

N O
;

O P
} 
} ¥
EC:\Repos\Service-Billing\Models\Repositories\IClientTeamRepository.cs
	namespace 	
Service_Billing
 
. 
Models  
.  !
Repositories! -
{ 
public 

	interface !
IClientTeamRepository *
{ 
public 
IEnumerable 
< 

ClientTeam %
>% &
AllTeams' /
{0 1
get2 5
;5 6
}7 8
public 

ClientTeam 
? 
GetTeamById &
(& '
int' *
?* +
id, .
). /
;/ 0
public 

ClientTeam 
? 
GetTeamByName (
(( )
string) /
teamName0 8
)8 9
;9 :
public 
IEnumerable 
< 

ClientTeam %
>% &&
GetTeamsByFinancialContact' A
(A B
stringB H
contactI P
)P Q
;Q R
public		 
IEnumerable		 
<		 

ClientTeam		 %
>		% &$
GetTeamsByPrimaryContact		' ?
(		? @
string		@ F
primaryContact		G U
)		U V
;		V W
public 
int 
Add 
( 

ClientTeam !
team" &
)& '
;' (
} 
} ’
CC:\Repos\Service-Billing\Models\Repositories\IMinistryRepository.cs
	namespace 	
Service_Billing
 
. 
Models  
.  !
Repositories! -
{ 
public 

	interface 
IMinistryRepository (
{ 
IEnumerable 
< 
Ministry 
> 
GetAll $
($ %
)% &
;& '
} 
} Ì	
JC:\Repos\Service-Billing\Models\Repositories\IServiceCategoryRepository.cs
	namespace 	
Service_Billing
 
. 
Models  
.  !
Repositories! -
{ 
public 

	interface &
IServiceCategoryRepository /
{ 
IEnumerable 
< 
ServiceCategory #
># $
GetAll% +
(+ ,
), -
;- .
int 
Add 
( 
ServiceCategory 
serviceCategory  /
)/ 0
;0 1
void 
Update 
( 
ServiceCategory #
serviceCategory$ 3
)3 4
;4 5
void 
Delete 
( 
ServiceCategory #
serviceCategory$ 3
)3 4
;4 5
IEnumerable		 
<		 
ServiceCategory		 #
>		# $
Search		% +
(		+ ,
string		, 2
queryString		3 >
)		> ?
;		? @
ServiceCategory

 
?

 
GetById

  
(

  !
int

! $
?

$ %
id

& (
)

( )
;

) *
} 
} ù	
BC:\Repos\Service-Billing\Models\Repositories\MinistryRepository.cs
	namespace 	
Service_Billing
 
. 
Models  
.  !
Repositories! -
{ 
public 

class 
MinistryRepository #
:# $
IMinistryRepository% 8
{ 
private 
readonly !
ServiceBillingContext .
_billingContext/ >
;> ?
public

 
MinistryRepository

 !
(

! "!
ServiceBillingContext

" 7
billingContext

8 F
)

F G
{ 	
_billingContext 
= 
billingContext ,
;, -
} 	
public 
IEnumerable 
< 
Ministry #
># $
GetAll% +
(+ ,
), -
{ 	
return 
_billingContext "
." #

Ministries# -
.- .
OrderBy. 5
(5 6
x6 7
=>8 :
x; <
.< =
Acronym= D
)D E
;E F
} 	
} 
} ›
IC:\Repos\Service-Billing\Models\Repositories\ServiceCategoryRepository.cs
	namespace 	
Service_Billing
 
. 
Models  
.  !
Repositories! -
{ 
public 

class %
ServiceCategoryRepository *
:* +&
IServiceCategoryRepository, F
{ 
private 
readonly !
ServiceBillingContext .
_context/ 7
;7 8
public		 %
ServiceCategoryRepository		 (
(		( )!
ServiceBillingContext		) >
context		? F
)		F G
{

 	
_context 
= 
context 
; 
} 	
public 
int 
Add 
( 
ServiceCategory &
serviceCategory' 6
)6 7
{ 	
_context 
. 
Add 
( 
serviceCategory (
)( )
;) *
_context 
. 
SaveChanges  
(  !
)! "
;" #
return 
serviceCategory "
." #
	ServiceId# ,
;, -
} 	
public 
void 
Delete 
( 
ServiceCategory *
serviceCategory+ :
): ;
{ 	
throw 
new #
NotImplementedException -
(- .
). /
;/ 0
} 	
public 
IEnumerable 
< 
ServiceCategory *
>* +
GetAll, 2
(2 3
)3 4
{ 	
return 
_context 
. 
ServiceCategories -
.- .
OrderBy. 5
(5 6
s6 7
=>8 :
s; <
.< =
Name= A
)A B
;B C
} 	
public 
ServiceCategory 
? 
GetById  '
(' (
int( +
?+ ,
id- /
)/ 0
{   	
return!! 
_context!! 
.!! 
ServiceCategories!! -
.!!- .
FirstOrDefault!!. <
(!!< =
s!!= >
=>!!? A
s!!B C
.!!C D
	ServiceId!!D M
==!!N P
id!!Q S
)!!S T
;!!T U
}"" 	
public$$ 
IEnumerable$$ 
<$$ 
ServiceCategory$$ *
>$$* +
Search$$, 2
($$2 3
string$$3 9
queryString$$: E
)$$E F
{%% 	
return&& 
_context&& 
.&& 
ServiceCategories&& -
.&&- .
Where&&. 3
(&&3 4
s&&4 5
=>&&6 8
s&&9 :
.&&: ;
Name&&; ?
==&&@ B
queryString&&C N
)&&N O
;&&O P
}'' 	
public)) 
void)) 
Update)) 
()) 
ServiceCategory)) *
serviceCategory))+ :
))): ;
{** 	
_context++ 
.++ 
Update++ 
(++ 
serviceCategory++ +
)+++ ,
;++, -
_context,, 
.,, 
SaveChanges,,  
(,,  !
true,,! %
),,% &
;,,& '
}-- 	
}.. 
}// ≥
2C:\Repos\Service-Billing\Models\SearchedContact.cs
	namespace 	
Service_Billing
 
. 
Models  
{ 
public 

class 
SearchedContact  
{ 
public 
string 
Id 
{ 
get 
; 
set  #
;# $
}% &
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
} 
} Û
2C:\Repos\Service-Billing\Models\ServiceCategory.cs
	namespace 	
Service_Billing
 
. 
Models  
{ 
public 

class 
ServiceCategory  
{ 
[ 	
Key	 
] 
public		 
int		 
	ServiceId		 
{		 
get		 "
;		" #
set		$ '
;		' (
}		) *
[ 	
Display	 
( 
Name 
= 
$str +
)+ ,
], -
public 
string 
? 

GDXBusArea !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
string 
? 
Name 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
? 
Costs 
{ 
get "
;" #
set$ '
;' (
}) *
public 
string 
? 
Description "
{# $
get% (
;( )
set* -
;- .
}/ 0
[ 	
Display	 
( 
Name 
= 
$str $
)$ %
]% &
public 
bool 
IsActive 
{ 
get "
;" #
set$ '
;' (
}) *
public 
string 
? 
UOM 
{ 
get  
;  !
set" %
;% &
}' (
[ 	
Display	 
( 
Name 
= 
$str '
)' (
]( )
public 
string 
? 
ServiceOwner #
{$ %
get& )
;) *
set+ .
;. /
}0 1
} 
} ÙZ
#C:\Repos\Service-Billing\Program.cs
var 
builder 
= 
WebApplication 
. 
CreateBuilder *
(* +
args+ /
)/ 0
;0 1
string 
[ 
] 
initialScopes	 
= 
builder  
.  !
Configuration! .
.. /
GetValue/ 7
<7 8
string8 >
>> ?
(? @
$str@ V
)V W
?W X
.X Y
SplitY ^
(^ _
$char_ b
)b c
;c d
builder 
. 
Services 
. 
AddAuthentication "
(" #!
OpenIdConnectDefaults# 8
.8 9 
AuthenticationScheme9 M
)M N
. &
AddMicrosoftIdentityWebApp 
(  
builder  '
.' (
Configuration( 5
.5 6

GetSection6 @
(@ A
$strA J
)J K
)K L
. 5
)EnableTokenAcquisitionToCallDownstreamApi .
(. /
initialScopes/ <
)< =
. 
AddMicrosoftGraph 
( 
builder 
. 
Configuration ,
., -

GetSection- 7
(7 8
$str8 G
)G H
)H I
. "
AddInMemoryTokenCaches 
( 
) 
; 
builder 
. 
Services 
. 
	Configure 
< 
CookiePolicyOptions .
>. /
(/ 0
options0 7
=>8 :
{ 
options 
. 
CheckConsentNeeded 
=  
context! (
=>) +
true, 0
;0 1
options 
. !
MinimumSameSitePolicy !
=" #
SameSiteMode$ 0
.0 1
Unspecified1 <
;< =
options!! 
.!! -
!HandleSameSiteCookieCompatibility!! -
(!!- .
)!!. /
;!!/ 0
}"" 
)"" 
;"" 
builder%% 
.%% 
Services%% 
.%% #
AddControllersWithViews%% (
(%%( )
options%%) 0
=>%%1 3
{&& 
var'' 
policy'' 
='' 
new'' &
AuthorizationPolicyBuilder'' /
(''/ 0
)''0 1
.(( 	$
RequireAuthenticatedUser((	 !
(((! "
)((" #
.)) 	
Build))	 
()) 
))) 
;)) 
options** 
.** 
Filters** 
.** 
Add** 
(** 
new** 
AuthorizeFilter** +
(**+ ,
policy**, 2
)**2 3
)**3 4
;**4 5
}++ 
)++ 
.++ "
AddMicrosoftIdentityUI++ 
(++ 
)++ 
;++ 
builder-- 
.-- 
Services-- 
.-- 
	AddScoped-- 
<-- 
IBillRepositroy-- *
,--* +
BillRepository--, :
>--: ;
(--; <
)--< =
;--= >
builder.. 
... 
Services.. 
... 
	AddScoped.. 
<.. &
IServiceCategoryRepository.. 5
,..5 6%
ServiceCategoryRepository..7 P
>..P Q
(..Q R
)..R S
;..S T
builder// 
.// 
Services// 
.// 
	AddScoped// 
<// $
IClientAccountRepository// 3
,//3 4"
ClientAccountRepositry//5 K
>//K L
(//L M
)//M N
;//N O
builder00 
.00 
Services00 
.00 
	AddScoped00 
<00 !
IClientTeamRepository00 0
,000 1 
ClientTeamRepository002 F
>00F G
(00G H
)00H I
;00I J
builder11 
.11 
Services11 
.11 
	AddScoped11 
<11 
IMinistryRepository11 .
,11. /
MinistryRepository110 B
>11B C
(11C D
)11D E
;11E F
builder33 
.33 
Services33 
.33 
AddMvc33 
(33 
)33 
;33 
builder66 
.66 
Services66 
.66 
AddDbContext66 
<66 !
ServiceBillingContext66 3
>663 4
(664 5
options665 <
=>66= ?
options77 
.77 
UseSqlServer77 
(77 
builder77  
.77  !
Configuration77! .
.77. /
GetConnectionString77/ B
(77B C
$str77C Z
)77Z [
??77\ ^
throw77_ d
new77e h&
InvalidOperationException	77i Ç
(
77Ç É
$str
77É ∫
)
77∫ ª
)
77ª º
)
77º Ω
;
77Ω æ
builder99 
.99 
Services99 
.99 
AddRazorPages99 
(99 
)99  
.99  !
AddMvcOptions99! .
(99. /
options99/ 6
=>997 9
{:: 
var;; 
policy;; 
=;; 
new;; &
AuthorizationPolicyBuilder;; /
(;;/ 0
);;0 1
.<< $
RequireAuthenticatedUser<< +
(<<+ ,
)<<, -
.== 
Build== 
(== 
)== 
;== 
options>> 
.>> 
Filters>> 
.>> 
Add>> 
(>> 
new>> 
AuthorizeFilter>> +
(>>+ ,
policy>>, 2
)>>2 3
)>>3 4
;>>4 5
}?? 
)?? 
.?? "
AddMicrosoftIdentityUI?? 
(?? 
)?? 
;?? 
builderAA 
.AA 
ServicesAA 
.BB 
	ConfigureBB 
<BB  
OpenIdConnectOptionsBB #
>BB# $
(BB$ %!
OpenIdConnectDefaultsBB% :
.BB: ; 
AuthenticationSchemeBB; O
,BBO P
optionsBBQ X
=>BBY [
{CC 
optionsDD 
.DD 

SaveTokensDD 
=DD 
trueDD !
;DD! "
optionsEE 
.EE 
EventsEE 
=EE 
newEE 
OpenIdConnectEventsEE 0
{FF 	(
OnRedirectToIdentityProviderGG (
=GG) *
asyncGG+ 0
ctxtGG1 5
=>GG6 8
{HH 
ctxtII 
.II 
ProtocolMessageII $
.II$ %
RedirectUriII% 0
=II1 2
builderII3 :
.II: ;
ConfigurationII; H
[IIH I
$strIII _
]II_ `
;II` a
awaitJJ 
TaskJJ 
.JJ 
YieldJJ  
(JJ  !
)JJ! "
;JJ" #
}KK 
}LL 	
;LL	 

}MM 
)MM 
;MM 
builderOO 
.OO 
ServicesOO 
.OO 
AddServerSideBlazorOO $
(OO$ %
)OO% &
.PP .
"AddMicrosoftIdentityConsentHandlerPP 2
(PP2 3
)PP3 4
;PP4 5
builderRR 
.RR 
ServicesRR 
.RR 
AddAuthorizationRR !
(RR! "
optionsRR" )
=>RR* ,
{SS 
optionsTT 
.TT 
	AddPolicyTT 
(TT 
$strTT 3
,TT3 4
policyUU	 
=>UU 
policyUU 
.UU 
RequireRoleUU %
(UU% &
$strUU& J
)UUJ K
)UUK L
;UUL M
optionsVV 
.VV 
	AddPolicyVV 
(VV 
$strVV (
,VV( )
policyWW 
=>WW 
policyWW 
.WW 
RequireRoleWW $
(WW$ %
$strWW% >
)WW> ?
)WW? @
;WW@ A
optionsXX 
.XX 
	AddPolicyXX 
(XX 
$strXX '
,XX' (
policyYY 
=>YY 
policyYY 
.YY 
RequireRoleYY $
(YY$ %
$strYY% =
)YY= >
)YY> ?
;YY? @
}ZZ 
)ZZ 
;ZZ 
builder]] 
.]] 
Services]] 
.]] %
AddDistributedMemoryCache]] *
(]]* +
)]]+ ,
;]], -
builder__ 
.__ 
Services__ 
.__ 

AddSession__ 
(__ 
options__ #
=>__$ &
{`` 
optionsaa 
.aa 
IdleTimeoutaa 
=aa 
TimeSpanaa "
.aa" #
FromMinutesaa# .
(aa. /
$numaa/ 1
)aa1 2
;aa2 3
optionsbb 
.bb 
Cookiebb 
.bb 
HttpOnlybb 
=bb 
truebb "
;bb" #
}cc 
)cc 
;cc 
varee 
appee 
=ee 	
builderee
 
.ee 
Buildee 
(ee 
)ee 
;ee 
vargg #
fordwardedHeaderOptionsgg 
=gg 
newgg !#
ForwardedHeadersOptionsgg" 9
{hh 
ForwardedHeadersii 
=ii 
ForwardedHeadersii '
.ii' (
XForwardedForii( 5
|ii6 7
ForwardedHeadersii8 H
.iiH I
XForwardedProtoiiI X
}jj 
;jj !
fordwardedHeaderOptionskk 
.kk 
KnownNetworkskk %
.kk% &
Clearkk& +
(kk+ ,
)kk, -
;kk- .!
fordwardedHeaderOptionsll 
.ll 
KnownProxiesll $
.ll$ %
Clearll% *
(ll* +
)ll+ ,
;ll, -
appoo 
.oo 
UseForwardedHeadersoo 
(oo #
fordwardedHeaderOptionsoo /
)oo/ 0
;oo0 1
ifqq 
(qq 
!qq 
appqq 
.qq 	
Environmentqq	 
.qq 
IsDevelopmentqq "
(qq" #
)qq# $
)qq$ %
{rr 
appss 
.ss 
UseExceptionHandlerss 
(ss 
$strss )
)ss) *
;ss* +
appuu 
.uu 
UseHstsuu 
(uu 
)uu 
;uu 
}vv 
appxx 
.xx 

UseSessionxx 
(xx 
)xx 
;xx 
appzz 
.zz 
UseHttpsRedirectionzz 
(zz 
)zz 
;zz 
app{{ 
.{{ 
UseStaticFiles{{ 
({{ 
){{ 
;{{ 
app|| 
.|| 
UseCookiePolicy|| 
(|| 
)|| 
;|| 
app}} 
.}} 

UseRouting}} 
(}} 
)}} 
;}} 
app 
. 
UseAuthorization 
( 
) 
; 
appÅÅ 
.
ÅÅ  
MapControllerRoute
ÅÅ 
(
ÅÅ 
name
ÇÇ 
:
ÇÇ 	
$str
ÇÇ
 
,
ÇÇ 
pattern
ÉÉ 
:
ÉÉ 
$str
ÉÉ 5
)
ÉÉ5 6
;
ÉÉ6 7
appÑÑ 
.
ÑÑ 
MapRazorPages
ÑÑ 
(
ÑÑ 
)
ÑÑ 
;
ÑÑ 
appÜÜ 
.
ÜÜ 
Run
ÜÜ 
(
ÜÜ 
)
ÜÜ 	
;
ÜÜ	 
ˇ
3C:\Repos\Service-Billing\Reports\ReportGenerator.cs
	namespace 	
Service_Billing
 
. 
Reports !
{ 
public 

class 
ReportGenerator  
{ 
public 
void #
GenerateQuarterlyReport +
(+ ,
int, /
clientId0 8
,8 9
DateTime: B
?B C
fromDateD L
)L M
{ 	
} 	
} 
} ˝
8C:\Repos\Service-Billing\ViewModels\AllBillsViewModel.cs
	namespace 	
Service_Billing
 
. 

ViewModels $
{ 
public 

class 
AllBillsViewModel "
{ 
public 
IEnumerable 
< 
Bill 
>  
Bills! &
{' (
get) ,
;, -
}. /
public 
IEnumerable 
< 
ServiceCategory *
>* +
ServiceCategories, =
{> ?
get@ C
;C D
}E F
public		 
IEnumerable		 
<		 
ClientAccount		 (
>		( )
ClientAccounts		* 8
{		9 :
get		; >
;		> ?
}		@ A
public 
AllBillsViewModel  
(  !
IEnumerable! ,
<, -
Bill- 1
>1 2
bills3 8
,8 9
IEnumerable: E
<E F
ServiceCategoryF U
>U V
serviceCategoriesW h
,h i
IEnumerablej u
<u v
ClientAccount	v É
>
É Ñ
clients
Ö å
)
å ç
{ 	
Bills 
= 
bills 
; 
ServiceCategories 
= 
serviceCategories  1
;1 2
ClientAccounts 
= 
clients $
;$ %
} 	
} 
} Ö
=C:\Repos\Service-Billing\ViewModels\ClientAccountViewModel.cs
	namespace 	
Service_Billing
 
. 

ViewModels $
{ 
public 

class "
ClientAccountViewModel '
{ 
public 
IEnumerable 
< 
ClientAccount (
>( )
ClientAccounts* 8
{9 :
get; >
;> ?
}@ A
public		 "
ClientAccountViewModel		 %
(		% &
IEnumerable		& 1
<		1 2
ClientAccount		2 ?
>		? @
clients		A H
)		H I
{

 	
ClientAccounts 
= 
clients $
;$ %
} 	
} 
} ‰
<C:\Repos\Service-Billing\ViewModels\ClientIntakeViewModel.cs
	namespace 	
Service_Billing
 
. 

ViewModels $
{ 
public 

class !
ClientIntakeViewModel &
{		 
public

 
int

 
Id

 
{

 
get

 
;

 
set

  
;

  !
}

" #
public 

ClientTeam 
? 
Team 
{  !
get" %
;% &
set' *
;* +
}, -
public 
ClientAccount 
Account $
{% &
get' *
;* +
set, /
;/ 0
}1 2
public 
string 
? 
MinistryAcronym &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public 
string 
? 
DivisionOrBranch '
{( )
get* -
;- .
set/ 2
;2 3
}4 5
[ 	
	NotMapped	 
] 
public 
IEnumerable 
< 
SelectListItem )
>) *
?* +
Contacts, 4
{5 6
get7 :
;: ;
set< ?
;? @
}A B
public !
ClientIntakeViewModel $
($ %
)% &
{ 	
Team 
= 
new 

ClientTeam !
(! "
)" #
;# $
Account 
= 
new 
ClientAccount '
(' (
)( )
;) *
} 	
} 
} π
=C:\Repos\Service-Billing\ViewModels\ContactSelectViewModel.cs
	namespace 	
Service_Billing
 
. 

ViewModels $
{ 
public 

class "
ContactSelectViewModel '
{ 
public 
string 
	elementId 
{  !
get" %
;% &
set' *
;* +
}, -
public 
IEnumerable 
< 
SelectListItem )
>) *
Contacts+ 3
{4 5
get6 9
;9 :
set; >
;> ?
}@ A
public

 "
ContactSelectViewModel

 %
(

% &
string

& ,
?

, -
id

. 0
,

0 1
IEnumerable

2 =
<

= >
SelectListItem

> L
>

L M
list

N R
)

R S
{ 	
	elementId 
= 
id 
; 
Contacts 
= 
list 
; 
} 	
} 
} £
?C:\Repos\Service-Billing\ViewModels\GeneratedReportViewModel.cs
	namespace 	
Service_Billing
 
. 

ViewModels $
{ 
public 

class $
GeneratedReportViewModel )
{		 
public

 
SortedDictionary

 
<

  
string

  &
,

& '
decimal

( /
?

/ 0
>

0 1
ServicesAndSums

2 A
{

B C
get

D G
;

G H
set

I L
;

L M
}

N O
public 
string 
BillingQuarter $
{% &
get' *
;* +
set, /
;/ 0
}1 2
=3 4
string5 ;
.; <
Empty< A
;A B
public 
string 
Title 
{ 
get !
;! "
set# &
;& '
}( )
=* +
string, 2
.2 3
Empty3 8
;8 9
public 
string 
Ministry 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
public 
string 
Service 
{ 
get  #
;# $
set% (
;( )
}* +
=, -
string. 4
.4 5
Empty5 :
;: ;
public 
int 
ServiceCategoryId $
{% &
get' *
;* +
set, /
;/ 0
}1 2
public 
string 
	Authority 
{  !
get" %
;% &
set' *
;* +
}, -
=. /
string0 6
.6 7
Empty7 <
;< =
public 
int 
ClientNumber 
{  !
get" %
;% &
set' *
;* +
}, -
} 
} 